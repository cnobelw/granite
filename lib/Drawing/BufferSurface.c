/* BufferSurface.c generated by valac 0.36.7, the Vala compiler
 * generated from BufferSurface.vala, do not modify */


#include <glib.h>
#include <glib-object.h>
#include <cairo.h>
#include <float.h>
#include <math.h>
#include <gdk-pixbuf/gdk-pixbuf.h>
#include <string.h>


#define GRANITE_DRAWING_TYPE_BUFFER_SURFACE (granite_drawing_buffer_surface_get_type ())
#define GRANITE_DRAWING_BUFFER_SURFACE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), GRANITE_DRAWING_TYPE_BUFFER_SURFACE, GraniteDrawingBufferSurface))
#define GRANITE_DRAWING_BUFFER_SURFACE_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), GRANITE_DRAWING_TYPE_BUFFER_SURFACE, GraniteDrawingBufferSurfaceClass))
#define GRANITE_DRAWING_IS_BUFFER_SURFACE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), GRANITE_DRAWING_TYPE_BUFFER_SURFACE))
#define GRANITE_DRAWING_IS_BUFFER_SURFACE_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), GRANITE_DRAWING_TYPE_BUFFER_SURFACE))
#define GRANITE_DRAWING_BUFFER_SURFACE_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), GRANITE_DRAWING_TYPE_BUFFER_SURFACE, GraniteDrawingBufferSurfaceClass))

typedef struct _GraniteDrawingBufferSurface GraniteDrawingBufferSurface;
typedef struct _GraniteDrawingBufferSurfaceClass GraniteDrawingBufferSurfaceClass;
typedef struct _GraniteDrawingBufferSurfacePrivate GraniteDrawingBufferSurfacePrivate;
#define _cairo_surface_destroy0(var) ((var == NULL) ? NULL : (var = (cairo_surface_destroy (var), NULL)))
#define _cairo_destroy0(var) ((var == NULL) ? NULL : (var = (cairo_destroy (var), NULL)))
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))

#define GRANITE_DRAWING_TYPE_COLOR (granite_drawing_color_get_type ())
#define GRANITE_DRAWING_COLOR(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), GRANITE_DRAWING_TYPE_COLOR, GraniteDrawingColor))
#define GRANITE_DRAWING_COLOR_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), GRANITE_DRAWING_TYPE_COLOR, GraniteDrawingColorClass))
#define GRANITE_DRAWING_IS_COLOR(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), GRANITE_DRAWING_TYPE_COLOR))
#define GRANITE_DRAWING_IS_COLOR_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), GRANITE_DRAWING_TYPE_COLOR))
#define GRANITE_DRAWING_COLOR_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), GRANITE_DRAWING_TYPE_COLOR, GraniteDrawingColorClass))

typedef struct _GraniteDrawingColor GraniteDrawingColor;
typedef struct _GraniteDrawingColorClass GraniteDrawingColorClass;
typedef struct _Block1Data Block1Data;
#define _g_thread_unref0(var) ((var == NULL) ? NULL : (var = (g_thread_unref (var), NULL)))
#define _g_error_free0(var) ((var == NULL) ? NULL : (var = (g_error_free (var), NULL)))
typedef struct _Block2Data Block2Data;
#define _vala_assert(expr, msg) if G_LIKELY (expr) ; else g_assertion_message_expr (G_LOG_DOMAIN, __FILE__, __LINE__, G_STRFUNC, msg);
#define _vala_return_if_fail(expr, msg) if G_LIKELY (expr) ; else { g_return_if_fail_warning (G_LOG_DOMAIN, G_STRFUNC, msg); return; }
#define _vala_return_val_if_fail(expr, msg, val) if G_LIKELY (expr) ; else { g_return_if_fail_warning (G_LOG_DOMAIN, G_STRFUNC, msg); return val; }
#define _vala_warn_if_fail(expr, msg) if G_LIKELY (expr) ; else g_warn_message (G_LOG_DOMAIN, __FILE__, __LINE__, G_STRFUNC, msg);

struct _GraniteDrawingBufferSurface {
	GObject parent_instance;
	GraniteDrawingBufferSurfacePrivate * priv;
};

struct _GraniteDrawingBufferSurfaceClass {
	GObjectClass parent_class;
};

struct _GraniteDrawingBufferSurfacePrivate {
	cairo_surface_t* _surface;
	gint _width;
	gint _height;
	cairo_t* _context;
};

struct _Block1Data {
	int _ref_count_;
	GraniteDrawingBufferSurface* self;
	gint alpha;
	gint height;
	gint width;
	guint8* pixels;
};

struct _Block2Data {
	int _ref_count_;
	GraniteDrawingBufferSurface* self;
	gint gausswidth;
	gdouble* kernel;
	gint kernel_length1;
	gint _kernel_size_;
	gint width;
	gint height;
	gdouble* abuffer;
	gint abuffer_length1;
	gint _abuffer_size_;
	gdouble* bbuffer;
	gint bbuffer_length1;
	gint _bbuffer_size_;
	gint* shiftar;
	gint shiftar_length1;
	gint shiftar_length2;
	gint _shiftar_size_;
};


static gpointer granite_drawing_buffer_surface_parent_class = NULL;

GType granite_drawing_buffer_surface_get_type (void) G_GNUC_CONST;
#define GRANITE_DRAWING_BUFFER_SURFACE_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), GRANITE_DRAWING_TYPE_BUFFER_SURFACE, GraniteDrawingBufferSurfacePrivate))
enum  {
	GRANITE_DRAWING_BUFFER_SURFACE_0_PROPERTY,
	GRANITE_DRAWING_BUFFER_SURFACE_SURFACE_PROPERTY,
	GRANITE_DRAWING_BUFFER_SURFACE_WIDTH_PROPERTY,
	GRANITE_DRAWING_BUFFER_SURFACE_HEIGHT_PROPERTY,
	GRANITE_DRAWING_BUFFER_SURFACE_CONTEXT_PROPERTY
};
#define GRANITE_DRAWING_BUFFER_SURFACE_AlphaPrecision 16
#define GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision 7
GraniteDrawingBufferSurface* granite_drawing_buffer_surface_new (gint width, gint height);
GraniteDrawingBufferSurface* granite_drawing_buffer_surface_construct (GType object_type, gint width, gint height);
static void granite_drawing_buffer_surface_set_width (GraniteDrawingBufferSurface* self, gint value);
static void granite_drawing_buffer_surface_set_height (GraniteDrawingBufferSurface* self, gint value);
GraniteDrawingBufferSurface* granite_drawing_buffer_surface_new_with_surface (gint width, gint height, cairo_surface_t* model);
GraniteDrawingBufferSurface* granite_drawing_buffer_surface_construct_with_surface (GType object_type, gint width, gint height, cairo_surface_t* model);
static void granite_drawing_buffer_surface_set_surface (GraniteDrawingBufferSurface* self, cairo_surface_t* value);
GraniteDrawingBufferSurface* granite_drawing_buffer_surface_new_with_buffer_surface (gint width, gint height, GraniteDrawingBufferSurface* model);
GraniteDrawingBufferSurface* granite_drawing_buffer_surface_construct_with_buffer_surface (GType object_type, gint width, gint height, GraniteDrawingBufferSurface* model);
cairo_surface_t* granite_drawing_buffer_surface_get_surface (GraniteDrawingBufferSurface* self);
void granite_drawing_buffer_surface_clear (GraniteDrawingBufferSurface* self);
cairo_t* granite_drawing_buffer_surface_get_context (GraniteDrawingBufferSurface* self);
GdkPixbuf* granite_drawing_buffer_surface_load_to_pixbuf (GraniteDrawingBufferSurface* self);
gint granite_drawing_buffer_surface_get_width (GraniteDrawingBufferSurface* self);
gint granite_drawing_buffer_surface_get_height (GraniteDrawingBufferSurface* self);
GType granite_drawing_color_get_type (void) G_GNUC_CONST;
GraniteDrawingColor* granite_drawing_buffer_surface_average_color (GraniteDrawingBufferSurface* self);
GraniteDrawingColor* granite_drawing_color_new (gdouble R, gdouble G, gdouble B, gdouble A);
GraniteDrawingColor* granite_drawing_color_construct (GType object_type, gdouble R, gdouble G, gdouble B, gdouble A);
GraniteDrawingColor* granite_drawing_color_set_val (GraniteDrawingColor* self, gdouble val);
GraniteDrawingColor* granite_drawing_color_multiply_sat (GraniteDrawingColor* self, gdouble amount);
void granite_drawing_buffer_surface_fast_blur (GraniteDrawingBufferSurface* self, gint radius, gint process_count);
void granite_drawing_buffer_surface_exponential_blur (GraniteDrawingBufferSurface* self, gint radius);
static Block1Data* block1_data_ref (Block1Data* _data1_);
static void block1_data_unref (void * _userdata_);
static void* ___lambda5_ (Block1Data* _data1_);
static void granite_drawing_buffer_surface_exponential_blur_rows (GraniteDrawingBufferSurface* self, guint8* pixels, gint width, gint height, gint startRow, gint endRow, gint startX, gint endX, gint alpha);
static gpointer ____lambda5__gthread_func (gpointer self);
static void* ___lambda6_ (Block1Data* _data1_);
static void granite_drawing_buffer_surface_exponential_blur_columns (GraniteDrawingBufferSurface* self, guint8* pixels, gint width, gint height, gint startCol, gint endCol, gint startY, gint endY, gint alpha);
static gpointer ____lambda6__gthread_func (gpointer self);
static inline void granite_drawing_buffer_surface_exponential_blur_inner (guint8* pixel, gint* zA, gint* zR, gint* zG, gint* zB, gint alpha);
void granite_drawing_buffer_surface_gaussian_blur (GraniteDrawingBufferSurface* self, gint radius);
static Block2Data* block2_data_ref (Block2Data* _data2_);
static void block2_data_unref (void * _userdata_);
static gdouble* granite_drawing_buffer_surface_build_gaussian_kernel (gint gausswidth, int* result_length1);
static void* ___lambda7_ (Block2Data* _data2_);
static void granite_drawing_buffer_surface_gaussian_blur_horizontal (GraniteDrawingBufferSurface* self, gdouble* src, gdouble* dest, gdouble* kernel, gint gausswidth, gint width, gint height, gint startRow, gint endRow, gint* shift, int shift_length1, int shift_length2);
static gpointer ____lambda7__gthread_func (gpointer self);
static void* ___lambda8_ (Block2Data* _data2_);
static void granite_drawing_buffer_surface_gaussian_blur_vertical (GraniteDrawingBufferSurface* self, gdouble* src, gdouble* dest, gdouble* kernel, gint gausswidth, gint width, gint height, gint startCol, gint endCol, gint* shift, int shift_length1, int shift_length2);
static gpointer ____lambda8__gthread_func (gpointer self);
static void granite_drawing_buffer_surface_finalize (GObject * obj);
static void _vala_granite_drawing_buffer_surface_get_property (GObject * object, guint property_id, GValue * value, GParamSpec * pspec);
static void _vala_granite_drawing_buffer_surface_set_property (GObject * object, guint property_id, const GValue * value, GParamSpec * pspec);


/**
         * Constructs a new, empty {@link Granite.Drawing.BufferSurface} with the supplied dimensions.
         *
         * @param width the width of {@link Granite.Drawing.BufferSurface}, in pixels
         * @param height the height of the {@link Granite.Drawing.BufferSurface}, in pixels
         */
GraniteDrawingBufferSurface* granite_drawing_buffer_surface_construct (GType object_type, gint width, gint height) {
	GraniteDrawingBufferSurface * self = NULL;
	gint _tmp0_;
	gint _tmp1_;
	gint _tmp2_;
	gint _tmp3_;
	_tmp0_ = width;
	_tmp1_ = height;
	_vala_return_val_if_fail ((_tmp0_ >= 0) && (_tmp1_ >= 0), "width >= 0 && height >= 0", NULL);
	self = (GraniteDrawingBufferSurface*) g_object_new (object_type, NULL);
	_tmp2_ = width;
	granite_drawing_buffer_surface_set_width (self, _tmp2_);
	_tmp3_ = height;
	granite_drawing_buffer_surface_set_height (self, _tmp3_);
	return self;
}


GraniteDrawingBufferSurface* granite_drawing_buffer_surface_new (gint width, gint height) {
	return granite_drawing_buffer_surface_construct (GRANITE_DRAWING_TYPE_BUFFER_SURFACE, width, height);
}


/**
         * Constructs a new, empty {@link Granite.Drawing.BufferSurface} with the supplied dimensions, using
         * the supplied {@link Cairo.Surface} as a model.
         *
         * @param width the width of the new {@link Granite.Drawing.BufferSurface}, in pixels
         * @param height the height of the new {@link Granite.Drawing.BufferSurface}, in pixels
         * @param model the {@link Cairo.Surface} to use as a model for the internal {@link Cairo.Surface}
         */
GraniteDrawingBufferSurface* granite_drawing_buffer_surface_construct_with_surface (GType object_type, gint width, gint height, cairo_surface_t* model) {
	GraniteDrawingBufferSurface * self = NULL;
	cairo_surface_t* _tmp0_;
	gint _tmp1_;
	gint _tmp2_;
	cairo_surface_t* _tmp3_;
	gint _tmp4_;
	gint _tmp5_;
	cairo_surface_t* _tmp6_;
	cairo_surface_t* _tmp7_;
	g_return_val_if_fail (model != NULL, NULL);
	_tmp0_ = model;
	_vala_return_val_if_fail (_tmp0_ != NULL, "model != null", NULL);
	_tmp1_ = width;
	_tmp2_ = height;
	self = (GraniteDrawingBufferSurface*) granite_drawing_buffer_surface_construct (object_type, _tmp1_, _tmp2_);
	_tmp3_ = model;
	_tmp4_ = width;
	_tmp5_ = height;
	_tmp6_ = cairo_surface_create_similar (_tmp3_, CAIRO_CONTENT_COLOR_ALPHA, _tmp4_, _tmp5_);
	_tmp7_ = _tmp6_;
	granite_drawing_buffer_surface_set_surface (self, _tmp7_);
	_cairo_surface_destroy0 (_tmp7_);
	return self;
}


GraniteDrawingBufferSurface* granite_drawing_buffer_surface_new_with_surface (gint width, gint height, cairo_surface_t* model) {
	return granite_drawing_buffer_surface_construct_with_surface (GRANITE_DRAWING_TYPE_BUFFER_SURFACE, width, height, model);
}


/**
         * Constructs a new, empty {@link Granite.Drawing.BufferSurface} with the supplied dimensions, using
         * the supplied {@link Granite.Drawing.BufferSurface} as a model.
         *
         * @param width the width of the new {@link Granite.Drawing.BufferSurface}, in pixels
         * @param height the height of the new {@link Granite.Drawing.BufferSurface}, in pixels
         * @param model the {@link Granite.Drawing.BufferSurface} to use as a model for the internal {@link Cairo.Surface}
         */
GraniteDrawingBufferSurface* granite_drawing_buffer_surface_construct_with_buffer_surface (GType object_type, gint width, gint height, GraniteDrawingBufferSurface* model) {
	GraniteDrawingBufferSurface * self = NULL;
	GraniteDrawingBufferSurface* _tmp0_;
	gint _tmp1_;
	gint _tmp2_;
	GraniteDrawingBufferSurface* _tmp3_;
	cairo_surface_t* _tmp4_;
	cairo_surface_t* _tmp5_;
	gint _tmp6_;
	gint _tmp7_;
	cairo_surface_t* _tmp8_;
	cairo_surface_t* _tmp9_;
	g_return_val_if_fail (model != NULL, NULL);
	_tmp0_ = model;
	_vala_return_val_if_fail (_tmp0_ != NULL, "model != null", NULL);
	_tmp1_ = width;
	_tmp2_ = height;
	self = (GraniteDrawingBufferSurface*) granite_drawing_buffer_surface_construct (object_type, _tmp1_, _tmp2_);
	_tmp3_ = model;
	_tmp4_ = granite_drawing_buffer_surface_get_surface (_tmp3_);
	_tmp5_ = _tmp4_;
	_tmp6_ = width;
	_tmp7_ = height;
	_tmp8_ = cairo_surface_create_similar (_tmp5_, CAIRO_CONTENT_COLOR_ALPHA, _tmp6_, _tmp7_);
	_tmp9_ = _tmp8_;
	granite_drawing_buffer_surface_set_surface (self, _tmp9_);
	_cairo_surface_destroy0 (_tmp9_);
	return self;
}


GraniteDrawingBufferSurface* granite_drawing_buffer_surface_new_with_buffer_surface (gint width, gint height, GraniteDrawingBufferSurface* model) {
	return granite_drawing_buffer_surface_construct_with_buffer_surface (GRANITE_DRAWING_TYPE_BUFFER_SURFACE, width, height, model);
}


/**
         * Clears the internal {@link Cairo.Surface}, making all pixels fully transparent.
         */
void granite_drawing_buffer_surface_clear (GraniteDrawingBufferSurface* self) {
	cairo_t* _tmp0_;
	cairo_t* _tmp1_;
	cairo_t* _tmp2_;
	cairo_t* _tmp3_;
	cairo_t* _tmp4_;
	cairo_t* _tmp5_;
	g_return_if_fail (self != NULL);
	_tmp0_ = granite_drawing_buffer_surface_get_context (self);
	_tmp1_ = _tmp0_;
	cairo_save (_tmp1_);
	_tmp2_ = self->priv->_context;
	cairo_set_source_rgba (_tmp2_, (gdouble) 0, (gdouble) 0, (gdouble) 0, (gdouble) 0);
	_tmp3_ = self->priv->_context;
	cairo_set_operator (_tmp3_, CAIRO_OPERATOR_SOURCE);
	_tmp4_ = self->priv->_context;
	cairo_paint (_tmp4_);
	_tmp5_ = self->priv->_context;
	cairo_restore (_tmp5_);
}


/**
         * Creates a {@link Gdk.Pixbuf} from internal {@link Cairo.Surface}.
         *
         * @return the {@link Gdk.Pixbuf}
         */
GdkPixbuf* granite_drawing_buffer_surface_load_to_pixbuf (GraniteDrawingBufferSurface* self) {
	GdkPixbuf* result = NULL;
	cairo_surface_t* image_surface = NULL;
	gint _tmp0_;
	gint _tmp1_;
	cairo_surface_t* _tmp2_;
	cairo_t* cr = NULL;
	cairo_surface_t* _tmp3_;
	cairo_t* _tmp4_;
	cairo_t* _tmp5_;
	cairo_t* _tmp6_;
	cairo_surface_t* _tmp7_;
	cairo_surface_t* _tmp8_;
	cairo_t* _tmp9_;
	gint width = 0;
	cairo_surface_t* _tmp10_;
	gint _tmp11_;
	gint height = 0;
	cairo_surface_t* _tmp12_;
	gint _tmp13_;
	GdkPixbuf* pb = NULL;
	gint _tmp14_;
	gint _tmp15_;
	GdkPixbuf* _tmp16_;
	GdkPixbuf* _tmp17_;
	guint8* data = NULL;
	cairo_surface_t* _tmp18_;
	guchar* _tmp19_;
	guint8* pixels = NULL;
	GdkPixbuf* _tmp20_;
	guint8* _tmp21_;
	gint length = 0;
	gint _tmp22_;
	gint _tmp23_;
	cairo_surface_t* _tmp24_;
	cairo_format_t _tmp25_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = self->priv->_width;
	_tmp1_ = self->priv->_height;
	_tmp2_ = cairo_image_surface_create (CAIRO_FORMAT_ARGB32, _tmp0_, _tmp1_);
	image_surface = _tmp2_;
	_tmp3_ = image_surface;
	_tmp4_ = cairo_create (_tmp3_);
	cr = _tmp4_;
	_tmp5_ = cr;
	cairo_set_operator (_tmp5_, CAIRO_OPERATOR_SOURCE);
	_tmp6_ = cr;
	_tmp7_ = granite_drawing_buffer_surface_get_surface (self);
	_tmp8_ = _tmp7_;
	cairo_set_source_surface (_tmp6_, _tmp8_, (gdouble) 0, (gdouble) 0);
	_tmp9_ = cr;
	cairo_paint (_tmp9_);
	_tmp10_ = image_surface;
	_tmp11_ = cairo_image_surface_get_width (_tmp10_);
	width = _tmp11_;
	_tmp12_ = image_surface;
	_tmp13_ = cairo_image_surface_get_height (_tmp12_);
	height = _tmp13_;
	_tmp14_ = width;
	_tmp15_ = height;
	_tmp16_ = gdk_pixbuf_new (GDK_COLORSPACE_RGB, TRUE, 8, _tmp14_, _tmp15_);
	pb = _tmp16_;
	_tmp17_ = pb;
	gdk_pixbuf_fill (_tmp17_, (guint32) 0x00000000);
	_tmp18_ = image_surface;
	_tmp19_ = cairo_image_surface_get_data (_tmp18_);
	data = _tmp19_;
	_tmp20_ = pb;
	_tmp21_ = gdk_pixbuf_get_pixels (_tmp20_);
	pixels = _tmp21_;
	_tmp22_ = width;
	_tmp23_ = height;
	length = _tmp22_ * _tmp23_;
	_tmp24_ = image_surface;
	_tmp25_ = cairo_image_surface_get_format (_tmp24_);
	if (_tmp25_ == CAIRO_FORMAT_ARGB32) {
		{
			gint i = 0;
			i = 0;
			{
				gboolean _tmp26_ = FALSE;
				_tmp26_ = TRUE;
				while (TRUE) {
					gint _tmp28_;
					gint _tmp29_;
					guint8* _tmp30_;
					guint8 _tmp31_;
					guint8* _tmp54_;
					guint8* _tmp55_;
					if (!_tmp26_) {
						gint _tmp27_;
						_tmp27_ = i;
						i = _tmp27_ + 1;
					}
					_tmp26_ = FALSE;
					_tmp28_ = i;
					_tmp29_ = length;
					if (!(_tmp28_ < _tmp29_)) {
						break;
					}
					_tmp30_ = data;
					_tmp31_ = _tmp30_[3];
					if (((gint) _tmp31_) > 0) {
						guint8* _tmp32_;
						guint8* _tmp33_;
						guint8 _tmp34_;
						guint8* _tmp35_;
						guint8 _tmp36_;
						guint8 _tmp37_;
						guint8* _tmp38_;
						guint8* _tmp39_;
						guint8 _tmp40_;
						guint8* _tmp41_;
						guint8 _tmp42_;
						guint8 _tmp43_;
						guint8* _tmp44_;
						guint8* _tmp45_;
						guint8 _tmp46_;
						guint8* _tmp47_;
						guint8 _tmp48_;
						guint8 _tmp49_;
						guint8* _tmp50_;
						guint8* _tmp51_;
						guint8 _tmp52_;
						guint8 _tmp53_;
						_tmp32_ = pixels;
						_tmp33_ = data;
						_tmp34_ = _tmp33_[2];
						_tmp35_ = data;
						_tmp36_ = _tmp35_[3];
						_tmp32_[0] = (guint8) ((_tmp34_ * 255) / _tmp36_);
						_tmp37_ = _tmp32_[0];
						_tmp38_ = pixels;
						_tmp39_ = data;
						_tmp40_ = _tmp39_[1];
						_tmp41_ = data;
						_tmp42_ = _tmp41_[3];
						_tmp38_[1] = (guint8) ((_tmp40_ * 255) / _tmp42_);
						_tmp43_ = _tmp38_[1];
						_tmp44_ = pixels;
						_tmp45_ = data;
						_tmp46_ = _tmp45_[0];
						_tmp47_ = data;
						_tmp48_ = _tmp47_[3];
						_tmp44_[2] = (guint8) ((_tmp46_ * 255) / _tmp48_);
						_tmp49_ = _tmp44_[2];
						_tmp50_ = pixels;
						_tmp51_ = data;
						_tmp52_ = _tmp51_[3];
						_tmp50_[3] = _tmp52_;
						_tmp53_ = _tmp50_[3];
					}
					_tmp54_ = pixels;
					pixels = _tmp54_ + 4;
					_tmp55_ = data;
					data = _tmp55_ + 4;
				}
			}
		}
	} else {
		cairo_surface_t* _tmp56_;
		cairo_format_t _tmp57_;
		_tmp56_ = image_surface;
		_tmp57_ = cairo_image_surface_get_format (_tmp56_);
		if (_tmp57_ == CAIRO_FORMAT_RGB24) {
			{
				gint i = 0;
				i = 0;
				{
					gboolean _tmp58_ = FALSE;
					_tmp58_ = TRUE;
					while (TRUE) {
						gint _tmp60_;
						gint _tmp61_;
						guint8* _tmp62_;
						guint8* _tmp63_;
						guint8 _tmp64_;
						guint8 _tmp65_;
						guint8* _tmp66_;
						guint8* _tmp67_;
						guint8 _tmp68_;
						guint8 _tmp69_;
						guint8* _tmp70_;
						guint8* _tmp71_;
						guint8 _tmp72_;
						guint8 _tmp73_;
						guint8* _tmp74_;
						guint8* _tmp75_;
						guint8 _tmp76_;
						guint8 _tmp77_;
						guint8* _tmp78_;
						guint8* _tmp79_;
						if (!_tmp58_) {
							gint _tmp59_;
							_tmp59_ = i;
							i = _tmp59_ + 1;
						}
						_tmp58_ = FALSE;
						_tmp60_ = i;
						_tmp61_ = length;
						if (!(_tmp60_ < _tmp61_)) {
							break;
						}
						_tmp62_ = pixels;
						_tmp63_ = data;
						_tmp64_ = _tmp63_[2];
						_tmp62_[0] = _tmp64_;
						_tmp65_ = _tmp62_[0];
						_tmp66_ = pixels;
						_tmp67_ = data;
						_tmp68_ = _tmp67_[1];
						_tmp66_[1] = _tmp68_;
						_tmp69_ = _tmp66_[1];
						_tmp70_ = pixels;
						_tmp71_ = data;
						_tmp72_ = _tmp71_[0];
						_tmp70_[2] = _tmp72_;
						_tmp73_ = _tmp70_[2];
						_tmp74_ = pixels;
						_tmp75_ = data;
						_tmp76_ = _tmp75_[3];
						_tmp74_[3] = _tmp76_;
						_tmp77_ = _tmp74_[3];
						_tmp78_ = pixels;
						pixels = _tmp78_ + 4;
						_tmp79_ = data;
						data = _tmp79_ + 4;
					}
				}
			}
		}
	}
	result = pb;
	_cairo_destroy0 (cr);
	_cairo_surface_destroy0 (image_surface);
	return result;
}


/**
         * Averages all the colors in the internal {@link Cairo.Surface}.
         *
         * @return the {@link Granite.Drawing.Color} with the averaged color
         */
GraniteDrawingColor* granite_drawing_buffer_surface_average_color (GraniteDrawingBufferSurface* self) {
	GraniteDrawingColor* result = NULL;
	gdouble bTotal = 0.0;
	gdouble gTotal = 0.0;
	gdouble rTotal = 0.0;
	gint w = 0;
	gint _tmp0_;
	gint h = 0;
	gint _tmp1_;
	cairo_surface_t* original = NULL;
	gint _tmp2_;
	gint _tmp3_;
	cairo_surface_t* _tmp4_;
	cairo_t* cr = NULL;
	cairo_surface_t* _tmp5_;
	cairo_t* _tmp6_;
	cairo_t* _tmp7_;
	cairo_t* _tmp8_;
	cairo_surface_t* _tmp9_;
	cairo_surface_t* _tmp10_;
	cairo_t* _tmp11_;
	guint8* data = NULL;
	cairo_surface_t* _tmp12_;
	guchar* _tmp13_;
	gint length = 0;
	gint _tmp14_;
	gint _tmp15_;
	gdouble _tmp53_;
	gint _tmp54_;
	gdouble _tmp55_;
	gint _tmp56_;
	gdouble _tmp57_;
	gint _tmp58_;
	GraniteDrawingColor* _tmp59_;
	GraniteDrawingColor* _tmp60_;
	GraniteDrawingColor* _tmp61_;
	GraniteDrawingColor* _tmp62_;
	GraniteDrawingColor* _tmp63_;
	GraniteDrawingColor* _tmp64_;
	g_return_val_if_fail (self != NULL, NULL);
	bTotal = 0.0;
	gTotal = 0.0;
	rTotal = 0.0;
	_tmp0_ = self->priv->_width;
	w = _tmp0_;
	_tmp1_ = self->priv->_height;
	h = _tmp1_;
	_tmp2_ = w;
	_tmp3_ = h;
	_tmp4_ = cairo_image_surface_create (CAIRO_FORMAT_ARGB32, _tmp2_, _tmp3_);
	original = _tmp4_;
	_tmp5_ = original;
	_tmp6_ = cairo_create (_tmp5_);
	cr = _tmp6_;
	_tmp7_ = cr;
	cairo_set_operator (_tmp7_, CAIRO_OPERATOR_SOURCE);
	_tmp8_ = cr;
	_tmp9_ = granite_drawing_buffer_surface_get_surface (self);
	_tmp10_ = _tmp9_;
	cairo_set_source_surface (_tmp8_, _tmp10_, (gdouble) 0, (gdouble) 0);
	_tmp11_ = cr;
	cairo_paint (_tmp11_);
	_tmp12_ = original;
	_tmp13_ = cairo_image_surface_get_data (_tmp12_);
	data = _tmp13_;
	_tmp14_ = w;
	_tmp15_ = h;
	length = _tmp14_ * _tmp15_;
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp16_ = FALSE;
			_tmp16_ = TRUE;
			while (TRUE) {
				gint _tmp18_;
				gint _tmp19_;
				guint8 b = 0U;
				guint8* _tmp20_;
				guint8 _tmp21_;
				guint8 g = 0U;
				guint8* _tmp22_;
				guint8 _tmp23_;
				guint8 r = 0U;
				guint8* _tmp24_;
				guint8 _tmp25_;
				guint8 max = 0U;
				guint8 _tmp26_;
				guint8 _tmp27_;
				guint8 _tmp28_;
				gdouble _tmp29_;
				gdouble _tmp30_;
				guint8 min = 0U;
				guint8 _tmp31_;
				guint8 _tmp32_;
				guint8 _tmp33_;
				gdouble _tmp34_;
				gdouble _tmp35_;
				gdouble delta = 0.0;
				guint8 _tmp36_;
				guint8 _tmp37_;
				gdouble _tmp38_ = 0.0;
				gdouble _tmp39_;
				gdouble sat = 0.0;
				gdouble score = 0.0;
				gdouble _tmp42_;
				gdouble _tmp43_;
				guint8 _tmp44_;
				gdouble _tmp45_;
				gdouble _tmp46_;
				guint8 _tmp47_;
				gdouble _tmp48_;
				gdouble _tmp49_;
				guint8 _tmp50_;
				gdouble _tmp51_;
				guint8* _tmp52_;
				if (!_tmp16_) {
					gint _tmp17_;
					_tmp17_ = i;
					i = _tmp17_ + 1;
				}
				_tmp16_ = FALSE;
				_tmp18_ = i;
				_tmp19_ = length;
				if (!(_tmp18_ < _tmp19_)) {
					break;
				}
				_tmp20_ = data;
				_tmp21_ = _tmp20_[0];
				b = _tmp21_;
				_tmp22_ = data;
				_tmp23_ = _tmp22_[1];
				g = _tmp23_;
				_tmp24_ = data;
				_tmp25_ = _tmp24_[2];
				r = _tmp25_;
				_tmp26_ = r;
				_tmp27_ = g;
				_tmp28_ = b;
				_tmp29_ = MAX ((gdouble) _tmp27_, (gdouble) _tmp28_);
				_tmp30_ = MAX ((gdouble) _tmp26_, _tmp29_);
				max = (guint8) _tmp30_;
				_tmp31_ = r;
				_tmp32_ = g;
				_tmp33_ = b;
				_tmp34_ = MIN ((gdouble) _tmp32_, (gdouble) _tmp33_);
				_tmp35_ = MIN ((gdouble) _tmp31_, _tmp34_);
				min = (guint8) _tmp35_;
				_tmp36_ = max;
				_tmp37_ = min;
				delta = (gdouble) (_tmp36_ - _tmp37_);
				_tmp39_ = delta;
				if (_tmp39_ == ((gdouble) 0)) {
					_tmp38_ = 0.0;
				} else {
					gdouble _tmp40_;
					guint8 _tmp41_;
					_tmp40_ = delta;
					_tmp41_ = max;
					_tmp38_ = _tmp40_ / _tmp41_;
				}
				sat = _tmp38_;
				_tmp42_ = sat;
				score = 0.2 + (0.8 * _tmp42_);
				_tmp43_ = bTotal;
				_tmp44_ = b;
				_tmp45_ = score;
				bTotal = _tmp43_ + (_tmp44_ * _tmp45_);
				_tmp46_ = gTotal;
				_tmp47_ = g;
				_tmp48_ = score;
				gTotal = _tmp46_ + (_tmp47_ * _tmp48_);
				_tmp49_ = rTotal;
				_tmp50_ = r;
				_tmp51_ = score;
				rTotal = _tmp49_ + (_tmp50_ * _tmp51_);
				_tmp52_ = data;
				data = _tmp52_ + 4;
			}
		}
	}
	_tmp53_ = rTotal;
	_tmp54_ = length;
	_tmp55_ = gTotal;
	_tmp56_ = length;
	_tmp57_ = bTotal;
	_tmp58_ = length;
	_tmp59_ = granite_drawing_color_new ((_tmp53_ / G_MAXUINT8) / _tmp54_, (_tmp55_ / G_MAXUINT8) / _tmp56_, (_tmp57_ / G_MAXUINT8) / _tmp58_, (gdouble) 1);
	_tmp60_ = _tmp59_;
	_tmp61_ = granite_drawing_color_set_val (_tmp60_, 0.8);
	_tmp62_ = _tmp61_;
	_tmp63_ = granite_drawing_color_multiply_sat (_tmp62_, 1.15);
	_tmp64_ = _tmp63_;
	_g_object_unref0 (_tmp62_);
	_g_object_unref0 (_tmp60_);
	result = _tmp64_;
	_cairo_destroy0 (cr);
	_cairo_surface_destroy0 (original);
	return result;
}


/**
         * Performs a blur operation on the internal {@link Cairo.Surface}, using the
         * fast-blur algorithm found here [[http://incubator.quasimondo.com/processing/superfastblur.pde]].
         *
         * @param radius the blur radius
         * @param process_count the number of times to perform the operation
         */
void granite_drawing_buffer_surface_fast_blur (GraniteDrawingBufferSurface* self, gint radius, gint process_count) {
	gboolean _tmp0_ = FALSE;
	gint _tmp1_;
	gint w = 0;
	gint _tmp3_;
	gint h = 0;
	gint _tmp4_;
	gint channels = 0;
	gboolean _tmp5_ = FALSE;
	gint _tmp6_;
	gint _tmp7_;
	cairo_surface_t* original = NULL;
	gint _tmp10_;
	gint _tmp11_;
	cairo_surface_t* _tmp12_;
	cairo_t* cr = NULL;
	cairo_surface_t* _tmp13_;
	cairo_t* _tmp14_;
	cairo_t* _tmp15_;
	cairo_t* _tmp16_;
	cairo_surface_t* _tmp17_;
	cairo_surface_t* _tmp18_;
	cairo_t* _tmp19_;
	guint8* pixels = NULL;
	cairo_surface_t* _tmp20_;
	guchar* _tmp21_;
	guint8* buffer = NULL;
	gint _tmp22_;
	gint _tmp23_;
	gint _tmp24_;
	guint8* _tmp25_;
	gint buffer_length1;
	gint _buffer_size_;
	gint* vmin = NULL;
	gint _tmp26_;
	gint _tmp27_;
	gint _tmp28_;
	gint* _tmp29_;
	gint vmin_length1;
	gint _vmin_size_;
	gint* vmax = NULL;
	gint _tmp30_;
	gint _tmp31_;
	gint _tmp32_;
	gint* _tmp33_;
	gint vmax_length1;
	gint _vmax_size_;
	gint div = 0;
	gint _tmp34_;
	guint8* dv = NULL;
	gint _tmp35_;
	guint8* _tmp36_;
	gint dv_length1;
	gint _dv_size_;
	cairo_surface_t* _tmp325_;
	cairo_t* _tmp326_;
	cairo_t* _tmp327_;
	cairo_t* _tmp328_;
	cairo_t* _tmp329_;
	cairo_surface_t* _tmp330_;
	cairo_t* _tmp331_;
	cairo_t* _tmp332_;
	cairo_t* _tmp333_;
	cairo_t* _tmp334_;
	g_return_if_fail (self != NULL);
	_tmp1_ = radius;
	if (_tmp1_ < 1) {
		_tmp0_ = TRUE;
	} else {
		gint _tmp2_;
		_tmp2_ = process_count;
		_tmp0_ = _tmp2_ < 1;
	}
	if (_tmp0_) {
		return;
	}
	_tmp3_ = self->priv->_width;
	w = _tmp3_;
	_tmp4_ = self->priv->_height;
	h = _tmp4_;
	channels = 4;
	_tmp6_ = radius;
	_tmp7_ = w;
	if (_tmp6_ > (_tmp7_ - 1)) {
		_tmp5_ = TRUE;
	} else {
		gint _tmp8_;
		gint _tmp9_;
		_tmp8_ = radius;
		_tmp9_ = h;
		_tmp5_ = _tmp8_ > (_tmp9_ - 1);
	}
	if (_tmp5_) {
		return;
	}
	_tmp10_ = w;
	_tmp11_ = h;
	_tmp12_ = cairo_image_surface_create (CAIRO_FORMAT_ARGB32, _tmp10_, _tmp11_);
	original = _tmp12_;
	_tmp13_ = original;
	_tmp14_ = cairo_create (_tmp13_);
	cr = _tmp14_;
	_tmp15_ = cr;
	cairo_set_operator (_tmp15_, CAIRO_OPERATOR_SOURCE);
	_tmp16_ = cr;
	_tmp17_ = granite_drawing_buffer_surface_get_surface (self);
	_tmp18_ = _tmp17_;
	cairo_set_source_surface (_tmp16_, _tmp18_, (gdouble) 0, (gdouble) 0);
	_tmp19_ = cr;
	cairo_paint (_tmp19_);
	_tmp20_ = original;
	_tmp21_ = cairo_image_surface_get_data (_tmp20_);
	pixels = _tmp21_;
	_tmp22_ = w;
	_tmp23_ = h;
	_tmp24_ = channels;
	_tmp25_ = g_new0 (guint8, (_tmp22_ * _tmp23_) * _tmp24_);
	buffer = _tmp25_;
	buffer_length1 = (_tmp22_ * _tmp23_) * _tmp24_;
	_buffer_size_ = buffer_length1;
	_tmp26_ = w;
	_tmp27_ = h;
	_tmp28_ = MAX (_tmp26_, _tmp27_);
	_tmp29_ = g_new0 (gint, _tmp28_);
	vmin = _tmp29_;
	vmin_length1 = _tmp28_;
	_vmin_size_ = vmin_length1;
	_tmp30_ = w;
	_tmp31_ = h;
	_tmp32_ = MAX (_tmp30_, _tmp31_);
	_tmp33_ = g_new0 (gint, _tmp32_);
	vmax = _tmp33_;
	vmax_length1 = _tmp32_;
	_vmax_size_ = vmax_length1;
	_tmp34_ = radius;
	div = (2 * _tmp34_) + 1;
	_tmp35_ = div;
	_tmp36_ = g_new0 (guint8, 256 * _tmp35_);
	dv = _tmp36_;
	dv_length1 = 256 * _tmp35_;
	_dv_size_ = dv_length1;
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp37_ = FALSE;
			_tmp37_ = TRUE;
			while (TRUE) {
				gint _tmp39_;
				guint8* _tmp40_;
				gint _tmp40__length1;
				guint8* _tmp41_;
				gint _tmp41__length1;
				gint _tmp42_;
				gint _tmp43_;
				gint _tmp44_;
				guint8 _tmp45_;
				if (!_tmp37_) {
					gint _tmp38_;
					_tmp38_ = i;
					i = _tmp38_ + 1;
				}
				_tmp37_ = FALSE;
				_tmp39_ = i;
				_tmp40_ = dv;
				_tmp40__length1 = dv_length1;
				if (!(_tmp39_ < _tmp40__length1)) {
					break;
				}
				_tmp41_ = dv;
				_tmp41__length1 = dv_length1;
				_tmp42_ = i;
				_tmp43_ = i;
				_tmp44_ = div;
				_tmp41_[_tmp42_] = (guint8) (_tmp43_ / _tmp44_);
				_tmp45_ = _tmp41_[_tmp42_];
			}
		}
	}
	while (TRUE) {
		gint _tmp46_;
		_tmp46_ = process_count;
		process_count = _tmp46_ - 1;
		if (!(_tmp46_ > 0)) {
			break;
		}
		{
			gint x = 0;
			x = 0;
			{
				gboolean _tmp47_ = FALSE;
				_tmp47_ = TRUE;
				while (TRUE) {
					gint _tmp49_;
					gint _tmp50_;
					gint* _tmp51_;
					gint _tmp51__length1;
					gint _tmp52_;
					gint _tmp53_;
					gint _tmp54_;
					gint _tmp55_;
					gint _tmp56_;
					gint _tmp57_;
					gint* _tmp58_;
					gint _tmp58__length1;
					gint _tmp59_;
					gint _tmp60_;
					gint _tmp61_;
					gint _tmp62_;
					gint _tmp63_;
					if (!_tmp47_) {
						gint _tmp48_;
						_tmp48_ = x;
						x = _tmp48_ + 1;
					}
					_tmp47_ = FALSE;
					_tmp49_ = x;
					_tmp50_ = w;
					if (!(_tmp49_ < _tmp50_)) {
						break;
					}
					_tmp51_ = vmin;
					_tmp51__length1 = vmin_length1;
					_tmp52_ = x;
					_tmp53_ = x;
					_tmp54_ = radius;
					_tmp55_ = w;
					_tmp56_ = MIN ((_tmp53_ + _tmp54_) + 1, _tmp55_ - 1);
					_tmp51_[_tmp52_] = _tmp56_;
					_tmp57_ = _tmp51_[_tmp52_];
					_tmp58_ = vmax;
					_tmp58__length1 = vmax_length1;
					_tmp59_ = x;
					_tmp60_ = x;
					_tmp61_ = radius;
					_tmp62_ = MAX (_tmp60_ - _tmp61_, 0);
					_tmp58_[_tmp59_] = _tmp62_;
					_tmp63_ = _tmp58_[_tmp59_];
				}
			}
		}
		{
			gint y = 0;
			y = 0;
			{
				gboolean _tmp64_ = FALSE;
				_tmp64_ = TRUE;
				while (TRUE) {
					gint _tmp66_;
					gint _tmp67_;
					gint asum = 0;
					gint rsum = 0;
					gint gsum = 0;
					gint bsum = 0;
					guint32 cur_pixel = 0U;
					gint _tmp68_;
					gint _tmp69_;
					gint _tmp70_;
					gint _tmp71_;
					gint _tmp72_;
					guint8* _tmp73_;
					guint32 _tmp74_;
					guint8 _tmp75_;
					gint _tmp76_;
					gint _tmp77_;
					guint8* _tmp78_;
					guint32 _tmp79_;
					guint8 _tmp80_;
					gint _tmp81_;
					gint _tmp82_;
					guint8* _tmp83_;
					guint32 _tmp84_;
					guint8 _tmp85_;
					gint _tmp86_;
					gint _tmp87_;
					guint8* _tmp88_;
					guint32 _tmp89_;
					guint8 _tmp90_;
					gint _tmp113_;
					gint _tmp114_;
					gint _tmp115_;
					if (!_tmp64_) {
						gint _tmp65_;
						_tmp65_ = y;
						y = _tmp65_ + 1;
					}
					_tmp64_ = FALSE;
					_tmp66_ = y;
					_tmp67_ = h;
					if (!(_tmp66_ < _tmp67_)) {
						break;
					}
					asum = 0;
					rsum = 0;
					gsum = 0;
					bsum = 0;
					_tmp68_ = y;
					_tmp69_ = w;
					_tmp70_ = channels;
					cur_pixel = (guint32) ((_tmp68_ * _tmp69_) * _tmp70_);
					_tmp71_ = asum;
					_tmp72_ = radius;
					_tmp73_ = pixels;
					_tmp74_ = cur_pixel;
					_tmp75_ = _tmp73_[_tmp74_ + 0];
					asum = _tmp71_ + (_tmp72_ * _tmp75_);
					_tmp76_ = rsum;
					_tmp77_ = radius;
					_tmp78_ = pixels;
					_tmp79_ = cur_pixel;
					_tmp80_ = _tmp78_[_tmp79_ + 1];
					rsum = _tmp76_ + (_tmp77_ * _tmp80_);
					_tmp81_ = gsum;
					_tmp82_ = radius;
					_tmp83_ = pixels;
					_tmp84_ = cur_pixel;
					_tmp85_ = _tmp83_[_tmp84_ + 2];
					gsum = _tmp81_ + (_tmp82_ * _tmp85_);
					_tmp86_ = bsum;
					_tmp87_ = radius;
					_tmp88_ = pixels;
					_tmp89_ = cur_pixel;
					_tmp90_ = _tmp88_[_tmp89_ + 3];
					bsum = _tmp86_ + (_tmp87_ * _tmp90_);
					{
						gint i = 0;
						i = 0;
						{
							gboolean _tmp91_ = FALSE;
							_tmp91_ = TRUE;
							while (TRUE) {
								gint _tmp93_;
								gint _tmp94_;
								gint _tmp95_;
								guint8* _tmp96_;
								guint32 _tmp97_;
								guint8 _tmp98_;
								gint _tmp99_;
								guint8* _tmp100_;
								guint32 _tmp101_;
								guint8 _tmp102_;
								gint _tmp103_;
								guint8* _tmp104_;
								guint32 _tmp105_;
								guint8 _tmp106_;
								gint _tmp107_;
								guint8* _tmp108_;
								guint32 _tmp109_;
								guint8 _tmp110_;
								guint32 _tmp111_;
								gint _tmp112_;
								if (!_tmp91_) {
									gint _tmp92_;
									_tmp92_ = i;
									i = _tmp92_ + 1;
								}
								_tmp91_ = FALSE;
								_tmp93_ = i;
								_tmp94_ = radius;
								if (!(_tmp93_ <= _tmp94_)) {
									break;
								}
								_tmp95_ = asum;
								_tmp96_ = pixels;
								_tmp97_ = cur_pixel;
								_tmp98_ = _tmp96_[_tmp97_ + 0];
								asum = _tmp95_ + _tmp98_;
								_tmp99_ = rsum;
								_tmp100_ = pixels;
								_tmp101_ = cur_pixel;
								_tmp102_ = _tmp100_[_tmp101_ + 1];
								rsum = _tmp99_ + _tmp102_;
								_tmp103_ = gsum;
								_tmp104_ = pixels;
								_tmp105_ = cur_pixel;
								_tmp106_ = _tmp104_[_tmp105_ + 2];
								gsum = _tmp103_ + _tmp106_;
								_tmp107_ = bsum;
								_tmp108_ = pixels;
								_tmp109_ = cur_pixel;
								_tmp110_ = _tmp108_[_tmp109_ + 3];
								bsum = _tmp107_ + _tmp110_;
								_tmp111_ = cur_pixel;
								_tmp112_ = channels;
								cur_pixel = _tmp111_ + _tmp112_;
							}
						}
					}
					_tmp113_ = y;
					_tmp114_ = w;
					_tmp115_ = channels;
					cur_pixel = (guint32) ((_tmp113_ * _tmp114_) * _tmp115_);
					{
						gint x = 0;
						x = 0;
						{
							gboolean _tmp116_ = FALSE;
							_tmp116_ = TRUE;
							while (TRUE) {
								gint _tmp118_;
								gint _tmp119_;
								guint32 p1 = 0U;
								gint _tmp120_;
								gint _tmp121_;
								gint* _tmp122_;
								gint _tmp122__length1;
								gint _tmp123_;
								gint _tmp124_;
								gint _tmp125_;
								guint32 p2 = 0U;
								gint _tmp126_;
								gint _tmp127_;
								gint* _tmp128_;
								gint _tmp128__length1;
								gint _tmp129_;
								gint _tmp130_;
								gint _tmp131_;
								guint8* _tmp132_;
								gint _tmp132__length1;
								guint32 _tmp133_;
								guint8* _tmp134_;
								gint _tmp134__length1;
								gint _tmp135_;
								guint8 _tmp136_;
								guint8 _tmp137_;
								guint8* _tmp138_;
								gint _tmp138__length1;
								guint32 _tmp139_;
								guint8* _tmp140_;
								gint _tmp140__length1;
								gint _tmp141_;
								guint8 _tmp142_;
								guint8 _tmp143_;
								guint8* _tmp144_;
								gint _tmp144__length1;
								guint32 _tmp145_;
								guint8* _tmp146_;
								gint _tmp146__length1;
								gint _tmp147_;
								guint8 _tmp148_;
								guint8 _tmp149_;
								guint8* _tmp150_;
								gint _tmp150__length1;
								guint32 _tmp151_;
								guint8* _tmp152_;
								gint _tmp152__length1;
								gint _tmp153_;
								guint8 _tmp154_;
								guint8 _tmp155_;
								gint _tmp156_;
								guint8* _tmp157_;
								guint32 _tmp158_;
								guint8 _tmp159_;
								guint8* _tmp160_;
								guint32 _tmp161_;
								guint8 _tmp162_;
								gint _tmp163_;
								guint8* _tmp164_;
								guint32 _tmp165_;
								guint8 _tmp166_;
								guint8* _tmp167_;
								guint32 _tmp168_;
								guint8 _tmp169_;
								gint _tmp170_;
								guint8* _tmp171_;
								guint32 _tmp172_;
								guint8 _tmp173_;
								guint8* _tmp174_;
								guint32 _tmp175_;
								guint8 _tmp176_;
								gint _tmp177_;
								guint8* _tmp178_;
								guint32 _tmp179_;
								guint8 _tmp180_;
								guint8* _tmp181_;
								guint32 _tmp182_;
								guint8 _tmp183_;
								guint32 _tmp184_;
								gint _tmp185_;
								if (!_tmp116_) {
									gint _tmp117_;
									_tmp117_ = x;
									x = _tmp117_ + 1;
								}
								_tmp116_ = FALSE;
								_tmp118_ = x;
								_tmp119_ = w;
								if (!(_tmp118_ < _tmp119_)) {
									break;
								}
								_tmp120_ = y;
								_tmp121_ = w;
								_tmp122_ = vmin;
								_tmp122__length1 = vmin_length1;
								_tmp123_ = x;
								_tmp124_ = _tmp122_[_tmp123_];
								_tmp125_ = channels;
								p1 = (guint32) (((_tmp120_ * _tmp121_) + _tmp124_) * _tmp125_);
								_tmp126_ = y;
								_tmp127_ = w;
								_tmp128_ = vmax;
								_tmp128__length1 = vmax_length1;
								_tmp129_ = x;
								_tmp130_ = _tmp128_[_tmp129_];
								_tmp131_ = channels;
								p2 = (guint32) (((_tmp126_ * _tmp127_) + _tmp130_) * _tmp131_);
								_tmp132_ = buffer;
								_tmp132__length1 = buffer_length1;
								_tmp133_ = cur_pixel;
								_tmp134_ = dv;
								_tmp134__length1 = dv_length1;
								_tmp135_ = asum;
								_tmp136_ = _tmp134_[_tmp135_];
								_tmp132_[_tmp133_ + 0] = _tmp136_;
								_tmp137_ = _tmp132_[_tmp133_ + 0];
								_tmp138_ = buffer;
								_tmp138__length1 = buffer_length1;
								_tmp139_ = cur_pixel;
								_tmp140_ = dv;
								_tmp140__length1 = dv_length1;
								_tmp141_ = rsum;
								_tmp142_ = _tmp140_[_tmp141_];
								_tmp138_[_tmp139_ + 1] = _tmp142_;
								_tmp143_ = _tmp138_[_tmp139_ + 1];
								_tmp144_ = buffer;
								_tmp144__length1 = buffer_length1;
								_tmp145_ = cur_pixel;
								_tmp146_ = dv;
								_tmp146__length1 = dv_length1;
								_tmp147_ = gsum;
								_tmp148_ = _tmp146_[_tmp147_];
								_tmp144_[_tmp145_ + 2] = _tmp148_;
								_tmp149_ = _tmp144_[_tmp145_ + 2];
								_tmp150_ = buffer;
								_tmp150__length1 = buffer_length1;
								_tmp151_ = cur_pixel;
								_tmp152_ = dv;
								_tmp152__length1 = dv_length1;
								_tmp153_ = bsum;
								_tmp154_ = _tmp152_[_tmp153_];
								_tmp150_[_tmp151_ + 3] = _tmp154_;
								_tmp155_ = _tmp150_[_tmp151_ + 3];
								_tmp156_ = asum;
								_tmp157_ = pixels;
								_tmp158_ = p1;
								_tmp159_ = _tmp157_[_tmp158_ + 0];
								_tmp160_ = pixels;
								_tmp161_ = p2;
								_tmp162_ = _tmp160_[_tmp161_ + 0];
								asum = _tmp156_ + (_tmp159_ - _tmp162_);
								_tmp163_ = rsum;
								_tmp164_ = pixels;
								_tmp165_ = p1;
								_tmp166_ = _tmp164_[_tmp165_ + 1];
								_tmp167_ = pixels;
								_tmp168_ = p2;
								_tmp169_ = _tmp167_[_tmp168_ + 1];
								rsum = _tmp163_ + (_tmp166_ - _tmp169_);
								_tmp170_ = gsum;
								_tmp171_ = pixels;
								_tmp172_ = p1;
								_tmp173_ = _tmp171_[_tmp172_ + 2];
								_tmp174_ = pixels;
								_tmp175_ = p2;
								_tmp176_ = _tmp174_[_tmp175_ + 2];
								gsum = _tmp170_ + (_tmp173_ - _tmp176_);
								_tmp177_ = bsum;
								_tmp178_ = pixels;
								_tmp179_ = p1;
								_tmp180_ = _tmp178_[_tmp179_ + 3];
								_tmp181_ = pixels;
								_tmp182_ = p2;
								_tmp183_ = _tmp181_[_tmp182_ + 3];
								bsum = _tmp177_ + (_tmp180_ - _tmp183_);
								_tmp184_ = cur_pixel;
								_tmp185_ = channels;
								cur_pixel = _tmp184_ + _tmp185_;
							}
						}
					}
				}
			}
		}
		{
			gint y = 0;
			y = 0;
			{
				gboolean _tmp186_ = FALSE;
				_tmp186_ = TRUE;
				while (TRUE) {
					gint _tmp188_;
					gint _tmp189_;
					gint* _tmp190_;
					gint _tmp190__length1;
					gint _tmp191_;
					gint _tmp192_;
					gint _tmp193_;
					gint _tmp194_;
					gint _tmp195_;
					gint _tmp196_;
					gint _tmp197_;
					gint* _tmp198_;
					gint _tmp198__length1;
					gint _tmp199_;
					gint _tmp200_;
					gint _tmp201_;
					gint _tmp202_;
					gint _tmp203_;
					gint _tmp204_;
					if (!_tmp186_) {
						gint _tmp187_;
						_tmp187_ = y;
						y = _tmp187_ + 1;
					}
					_tmp186_ = FALSE;
					_tmp188_ = y;
					_tmp189_ = h;
					if (!(_tmp188_ < _tmp189_)) {
						break;
					}
					_tmp190_ = vmin;
					_tmp190__length1 = vmin_length1;
					_tmp191_ = y;
					_tmp192_ = y;
					_tmp193_ = radius;
					_tmp194_ = h;
					_tmp195_ = MIN ((_tmp192_ + _tmp193_) + 1, _tmp194_ - 1);
					_tmp196_ = w;
					_tmp190_[_tmp191_] = _tmp195_ * _tmp196_;
					_tmp197_ = _tmp190_[_tmp191_];
					_tmp198_ = vmax;
					_tmp198__length1 = vmax_length1;
					_tmp199_ = y;
					_tmp200_ = y;
					_tmp201_ = radius;
					_tmp202_ = MAX (_tmp200_ - _tmp201_, 0);
					_tmp203_ = w;
					_tmp198_[_tmp199_] = _tmp202_ * _tmp203_;
					_tmp204_ = _tmp198_[_tmp199_];
				}
			}
		}
		{
			gint x = 0;
			x = 0;
			{
				gboolean _tmp205_ = FALSE;
				_tmp205_ = TRUE;
				while (TRUE) {
					gint _tmp207_;
					gint _tmp208_;
					gint asum = 0;
					gint rsum = 0;
					gint gsum = 0;
					gint bsum = 0;
					guint32 cur_pixel = 0U;
					gint _tmp209_;
					gint _tmp210_;
					gint _tmp211_;
					gint _tmp212_;
					guint8* _tmp213_;
					gint _tmp213__length1;
					guint32 _tmp214_;
					guint8 _tmp215_;
					gint _tmp216_;
					gint _tmp217_;
					guint8* _tmp218_;
					gint _tmp218__length1;
					guint32 _tmp219_;
					guint8 _tmp220_;
					gint _tmp221_;
					gint _tmp222_;
					guint8* _tmp223_;
					gint _tmp223__length1;
					guint32 _tmp224_;
					guint8 _tmp225_;
					gint _tmp226_;
					gint _tmp227_;
					guint8* _tmp228_;
					gint _tmp228__length1;
					guint32 _tmp229_;
					guint8 _tmp230_;
					gint _tmp254_;
					gint _tmp255_;
					if (!_tmp205_) {
						gint _tmp206_;
						_tmp206_ = x;
						x = _tmp206_ + 1;
					}
					_tmp205_ = FALSE;
					_tmp207_ = x;
					_tmp208_ = w;
					if (!(_tmp207_ < _tmp208_)) {
						break;
					}
					asum = 0;
					rsum = 0;
					gsum = 0;
					bsum = 0;
					_tmp209_ = x;
					_tmp210_ = channels;
					cur_pixel = (guint32) (_tmp209_ * _tmp210_);
					_tmp211_ = asum;
					_tmp212_ = radius;
					_tmp213_ = buffer;
					_tmp213__length1 = buffer_length1;
					_tmp214_ = cur_pixel;
					_tmp215_ = _tmp213_[_tmp214_ + 0];
					asum = _tmp211_ + (_tmp212_ * _tmp215_);
					_tmp216_ = rsum;
					_tmp217_ = radius;
					_tmp218_ = buffer;
					_tmp218__length1 = buffer_length1;
					_tmp219_ = cur_pixel;
					_tmp220_ = _tmp218_[_tmp219_ + 1];
					rsum = _tmp216_ + (_tmp217_ * _tmp220_);
					_tmp221_ = gsum;
					_tmp222_ = radius;
					_tmp223_ = buffer;
					_tmp223__length1 = buffer_length1;
					_tmp224_ = cur_pixel;
					_tmp225_ = _tmp223_[_tmp224_ + 2];
					gsum = _tmp221_ + (_tmp222_ * _tmp225_);
					_tmp226_ = bsum;
					_tmp227_ = radius;
					_tmp228_ = buffer;
					_tmp228__length1 = buffer_length1;
					_tmp229_ = cur_pixel;
					_tmp230_ = _tmp228_[_tmp229_ + 3];
					bsum = _tmp226_ + (_tmp227_ * _tmp230_);
					{
						gint i = 0;
						i = 0;
						{
							gboolean _tmp231_ = FALSE;
							_tmp231_ = TRUE;
							while (TRUE) {
								gint _tmp233_;
								gint _tmp234_;
								gint _tmp235_;
								guint8* _tmp236_;
								gint _tmp236__length1;
								guint32 _tmp237_;
								guint8 _tmp238_;
								gint _tmp239_;
								guint8* _tmp240_;
								gint _tmp240__length1;
								guint32 _tmp241_;
								guint8 _tmp242_;
								gint _tmp243_;
								guint8* _tmp244_;
								gint _tmp244__length1;
								guint32 _tmp245_;
								guint8 _tmp246_;
								gint _tmp247_;
								guint8* _tmp248_;
								gint _tmp248__length1;
								guint32 _tmp249_;
								guint8 _tmp250_;
								guint32 _tmp251_;
								gint _tmp252_;
								gint _tmp253_;
								if (!_tmp231_) {
									gint _tmp232_;
									_tmp232_ = i;
									i = _tmp232_ + 1;
								}
								_tmp231_ = FALSE;
								_tmp233_ = i;
								_tmp234_ = radius;
								if (!(_tmp233_ <= _tmp234_)) {
									break;
								}
								_tmp235_ = asum;
								_tmp236_ = buffer;
								_tmp236__length1 = buffer_length1;
								_tmp237_ = cur_pixel;
								_tmp238_ = _tmp236_[_tmp237_ + 0];
								asum = _tmp235_ + _tmp238_;
								_tmp239_ = rsum;
								_tmp240_ = buffer;
								_tmp240__length1 = buffer_length1;
								_tmp241_ = cur_pixel;
								_tmp242_ = _tmp240_[_tmp241_ + 1];
								rsum = _tmp239_ + _tmp242_;
								_tmp243_ = gsum;
								_tmp244_ = buffer;
								_tmp244__length1 = buffer_length1;
								_tmp245_ = cur_pixel;
								_tmp246_ = _tmp244_[_tmp245_ + 2];
								gsum = _tmp243_ + _tmp246_;
								_tmp247_ = bsum;
								_tmp248_ = buffer;
								_tmp248__length1 = buffer_length1;
								_tmp249_ = cur_pixel;
								_tmp250_ = _tmp248_[_tmp249_ + 3];
								bsum = _tmp247_ + _tmp250_;
								_tmp251_ = cur_pixel;
								_tmp252_ = w;
								_tmp253_ = channels;
								cur_pixel = _tmp251_ + (_tmp252_ * _tmp253_);
							}
						}
					}
					_tmp254_ = x;
					_tmp255_ = channels;
					cur_pixel = (guint32) (_tmp254_ * _tmp255_);
					{
						gint y = 0;
						y = 0;
						{
							gboolean _tmp256_ = FALSE;
							_tmp256_ = TRUE;
							while (TRUE) {
								gint _tmp258_;
								gint _tmp259_;
								guint32 p1 = 0U;
								gint _tmp260_;
								gint* _tmp261_;
								gint _tmp261__length1;
								gint _tmp262_;
								gint _tmp263_;
								gint _tmp264_;
								guint32 p2 = 0U;
								gint _tmp265_;
								gint* _tmp266_;
								gint _tmp266__length1;
								gint _tmp267_;
								gint _tmp268_;
								gint _tmp269_;
								guint8* _tmp270_;
								guint32 _tmp271_;
								guint8* _tmp272_;
								gint _tmp272__length1;
								gint _tmp273_;
								guint8 _tmp274_;
								guint8 _tmp275_;
								guint8* _tmp276_;
								guint32 _tmp277_;
								guint8* _tmp278_;
								gint _tmp278__length1;
								gint _tmp279_;
								guint8 _tmp280_;
								guint8 _tmp281_;
								guint8* _tmp282_;
								guint32 _tmp283_;
								guint8* _tmp284_;
								gint _tmp284__length1;
								gint _tmp285_;
								guint8 _tmp286_;
								guint8 _tmp287_;
								guint8* _tmp288_;
								guint32 _tmp289_;
								guint8* _tmp290_;
								gint _tmp290__length1;
								gint _tmp291_;
								guint8 _tmp292_;
								guint8 _tmp293_;
								gint _tmp294_;
								guint8* _tmp295_;
								gint _tmp295__length1;
								guint32 _tmp296_;
								guint8 _tmp297_;
								guint8* _tmp298_;
								gint _tmp298__length1;
								guint32 _tmp299_;
								guint8 _tmp300_;
								gint _tmp301_;
								guint8* _tmp302_;
								gint _tmp302__length1;
								guint32 _tmp303_;
								guint8 _tmp304_;
								guint8* _tmp305_;
								gint _tmp305__length1;
								guint32 _tmp306_;
								guint8 _tmp307_;
								gint _tmp308_;
								guint8* _tmp309_;
								gint _tmp309__length1;
								guint32 _tmp310_;
								guint8 _tmp311_;
								guint8* _tmp312_;
								gint _tmp312__length1;
								guint32 _tmp313_;
								guint8 _tmp314_;
								gint _tmp315_;
								guint8* _tmp316_;
								gint _tmp316__length1;
								guint32 _tmp317_;
								guint8 _tmp318_;
								guint8* _tmp319_;
								gint _tmp319__length1;
								guint32 _tmp320_;
								guint8 _tmp321_;
								guint32 _tmp322_;
								gint _tmp323_;
								gint _tmp324_;
								if (!_tmp256_) {
									gint _tmp257_;
									_tmp257_ = y;
									y = _tmp257_ + 1;
								}
								_tmp256_ = FALSE;
								_tmp258_ = y;
								_tmp259_ = h;
								if (!(_tmp258_ < _tmp259_)) {
									break;
								}
								_tmp260_ = x;
								_tmp261_ = vmin;
								_tmp261__length1 = vmin_length1;
								_tmp262_ = y;
								_tmp263_ = _tmp261_[_tmp262_];
								_tmp264_ = channels;
								p1 = (guint32) ((_tmp260_ + _tmp263_) * _tmp264_);
								_tmp265_ = x;
								_tmp266_ = vmax;
								_tmp266__length1 = vmax_length1;
								_tmp267_ = y;
								_tmp268_ = _tmp266_[_tmp267_];
								_tmp269_ = channels;
								p2 = (guint32) ((_tmp265_ + _tmp268_) * _tmp269_);
								_tmp270_ = pixels;
								_tmp271_ = cur_pixel;
								_tmp272_ = dv;
								_tmp272__length1 = dv_length1;
								_tmp273_ = asum;
								_tmp274_ = _tmp272_[_tmp273_];
								_tmp270_[_tmp271_ + 0] = _tmp274_;
								_tmp275_ = _tmp270_[_tmp271_ + 0];
								_tmp276_ = pixels;
								_tmp277_ = cur_pixel;
								_tmp278_ = dv;
								_tmp278__length1 = dv_length1;
								_tmp279_ = rsum;
								_tmp280_ = _tmp278_[_tmp279_];
								_tmp276_[_tmp277_ + 1] = _tmp280_;
								_tmp281_ = _tmp276_[_tmp277_ + 1];
								_tmp282_ = pixels;
								_tmp283_ = cur_pixel;
								_tmp284_ = dv;
								_tmp284__length1 = dv_length1;
								_tmp285_ = gsum;
								_tmp286_ = _tmp284_[_tmp285_];
								_tmp282_[_tmp283_ + 2] = _tmp286_;
								_tmp287_ = _tmp282_[_tmp283_ + 2];
								_tmp288_ = pixels;
								_tmp289_ = cur_pixel;
								_tmp290_ = dv;
								_tmp290__length1 = dv_length1;
								_tmp291_ = bsum;
								_tmp292_ = _tmp290_[_tmp291_];
								_tmp288_[_tmp289_ + 3] = _tmp292_;
								_tmp293_ = _tmp288_[_tmp289_ + 3];
								_tmp294_ = asum;
								_tmp295_ = buffer;
								_tmp295__length1 = buffer_length1;
								_tmp296_ = p1;
								_tmp297_ = _tmp295_[_tmp296_ + 0];
								_tmp298_ = buffer;
								_tmp298__length1 = buffer_length1;
								_tmp299_ = p2;
								_tmp300_ = _tmp298_[_tmp299_ + 0];
								asum = _tmp294_ + (_tmp297_ - _tmp300_);
								_tmp301_ = rsum;
								_tmp302_ = buffer;
								_tmp302__length1 = buffer_length1;
								_tmp303_ = p1;
								_tmp304_ = _tmp302_[_tmp303_ + 1];
								_tmp305_ = buffer;
								_tmp305__length1 = buffer_length1;
								_tmp306_ = p2;
								_tmp307_ = _tmp305_[_tmp306_ + 1];
								rsum = _tmp301_ + (_tmp304_ - _tmp307_);
								_tmp308_ = gsum;
								_tmp309_ = buffer;
								_tmp309__length1 = buffer_length1;
								_tmp310_ = p1;
								_tmp311_ = _tmp309_[_tmp310_ + 2];
								_tmp312_ = buffer;
								_tmp312__length1 = buffer_length1;
								_tmp313_ = p2;
								_tmp314_ = _tmp312_[_tmp313_ + 2];
								gsum = _tmp308_ + (_tmp311_ - _tmp314_);
								_tmp315_ = bsum;
								_tmp316_ = buffer;
								_tmp316__length1 = buffer_length1;
								_tmp317_ = p1;
								_tmp318_ = _tmp316_[_tmp317_ + 3];
								_tmp319_ = buffer;
								_tmp319__length1 = buffer_length1;
								_tmp320_ = p2;
								_tmp321_ = _tmp319_[_tmp320_ + 3];
								bsum = _tmp315_ + (_tmp318_ - _tmp321_);
								_tmp322_ = cur_pixel;
								_tmp323_ = w;
								_tmp324_ = channels;
								cur_pixel = _tmp322_ + (_tmp323_ * _tmp324_);
							}
						}
					}
				}
			}
		}
	}
	_tmp325_ = original;
	cairo_surface_mark_dirty (_tmp325_);
	_tmp326_ = granite_drawing_buffer_surface_get_context (self);
	_tmp327_ = _tmp326_;
	cairo_set_operator (_tmp327_, CAIRO_OPERATOR_SOURCE);
	_tmp328_ = granite_drawing_buffer_surface_get_context (self);
	_tmp329_ = _tmp328_;
	_tmp330_ = original;
	cairo_set_source_surface (_tmp329_, _tmp330_, (gdouble) 0, (gdouble) 0);
	_tmp331_ = granite_drawing_buffer_surface_get_context (self);
	_tmp332_ = _tmp331_;
	cairo_paint (_tmp332_);
	_tmp333_ = granite_drawing_buffer_surface_get_context (self);
	_tmp334_ = _tmp333_;
	cairo_set_operator (_tmp334_, CAIRO_OPERATOR_OVER);
	dv = (g_free (dv), NULL);
	vmax = (g_free (vmax), NULL);
	vmin = (g_free (vmin), NULL);
	buffer = (g_free (buffer), NULL);
	_cairo_destroy0 (cr);
	_cairo_surface_destroy0 (original);
}


/**
         * Performs a blur operation on the internal {@link Cairo.Surface}, using an
         * exponential blurring algorithm. This method is usually the fastest
         * and produces good-looking results (though not quite as good as gaussian's).
         *
         * @param radius the blur radius
         */
static Block1Data* block1_data_ref (Block1Data* _data1_) {
	g_atomic_int_inc (&_data1_->_ref_count_);
	return _data1_;
}


static void block1_data_unref (void * _userdata_) {
	Block1Data* _data1_;
	_data1_ = (Block1Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data1_->_ref_count_)) {
		GraniteDrawingBufferSurface* self;
		self = _data1_->self;
		_g_object_unref0 (self);
		g_slice_free (Block1Data, _data1_);
	}
}


static void* ___lambda5_ (Block1Data* _data1_) {
	GraniteDrawingBufferSurface* self;
	void* result = NULL;
	guint8* _tmp0_;
	gint _tmp1_;
	gint _tmp2_;
	gint _tmp3_;
	gint _tmp4_;
	gint _tmp5_;
	self = _data1_->self;
	_tmp0_ = _data1_->pixels;
	_tmp1_ = _data1_->width;
	_tmp2_ = _data1_->height;
	_tmp3_ = _data1_->height;
	_tmp4_ = _data1_->width;
	_tmp5_ = _data1_->alpha;
	granite_drawing_buffer_surface_exponential_blur_rows (self, _tmp0_, _tmp1_, _tmp2_, 0, _tmp3_ / 2, 0, _tmp4_, _tmp5_);
	result = NULL;
	return result;
}


static gpointer ____lambda5__gthread_func (gpointer self) {
	gpointer result;
	result = ___lambda5_ (self);
	block1_data_unref (self);
	return result;
}


static gpointer _g_thread_ref0 (gpointer self) {
	return self ? g_thread_ref (self) : NULL;
}


static void* ___lambda6_ (Block1Data* _data1_) {
	GraniteDrawingBufferSurface* self;
	void* result = NULL;
	guint8* _tmp0_;
	gint _tmp1_;
	gint _tmp2_;
	gint _tmp3_;
	gint _tmp4_;
	gint _tmp5_;
	self = _data1_->self;
	_tmp0_ = _data1_->pixels;
	_tmp1_ = _data1_->width;
	_tmp2_ = _data1_->height;
	_tmp3_ = _data1_->width;
	_tmp4_ = _data1_->height;
	_tmp5_ = _data1_->alpha;
	granite_drawing_buffer_surface_exponential_blur_columns (self, _tmp0_, _tmp1_, _tmp2_, 0, _tmp3_ / 2, 0, _tmp4_, _tmp5_);
	result = NULL;
	return result;
}


static gpointer ____lambda6__gthread_func (gpointer self) {
	gpointer result;
	result = ___lambda6_ (self);
	block1_data_unref (self);
	return result;
}


void granite_drawing_buffer_surface_exponential_blur (GraniteDrawingBufferSurface* self, gint radius) {
	Block1Data* _data1_;
	gint _tmp0_;
	gint _tmp1_;
	gdouble _tmp2_;
	gint _tmp3_;
	gint _tmp4_;
	cairo_surface_t* original = NULL;
	gint _tmp5_;
	gint _tmp6_;
	cairo_surface_t* _tmp7_;
	cairo_t* cr = NULL;
	cairo_surface_t* _tmp8_;
	cairo_t* _tmp9_;
	cairo_t* _tmp10_;
	cairo_t* _tmp11_;
	cairo_surface_t* _tmp12_;
	cairo_surface_t* _tmp13_;
	cairo_t* _tmp14_;
	cairo_surface_t* _tmp15_;
	guchar* _tmp16_;
	cairo_surface_t* _tmp39_;
	cairo_t* _tmp40_;
	cairo_t* _tmp41_;
	cairo_t* _tmp42_;
	cairo_t* _tmp43_;
	cairo_surface_t* _tmp44_;
	cairo_t* _tmp45_;
	cairo_t* _tmp46_;
	cairo_t* _tmp47_;
	cairo_t* _tmp48_;
	GError * _inner_error_ = NULL;
	g_return_if_fail (self != NULL);
	_data1_ = g_slice_new0 (Block1Data);
	_data1_->_ref_count_ = 1;
	_data1_->self = g_object_ref (self);
	_tmp0_ = radius;
	if (_tmp0_ < 1) {
		block1_data_unref (_data1_);
		_data1_ = NULL;
		return;
	}
	_tmp1_ = radius;
	_tmp2_ = exp ((-2.3) / (_tmp1_ + 1.0));
	_data1_->alpha = (gint) ((1 << GRANITE_DRAWING_BUFFER_SURFACE_AlphaPrecision) * (1.0 - _tmp2_));
	_tmp3_ = self->priv->_height;
	_data1_->height = _tmp3_;
	_tmp4_ = self->priv->_width;
	_data1_->width = _tmp4_;
	_tmp5_ = _data1_->width;
	_tmp6_ = _data1_->height;
	_tmp7_ = cairo_image_surface_create (CAIRO_FORMAT_ARGB32, _tmp5_, _tmp6_);
	original = _tmp7_;
	_tmp8_ = original;
	_tmp9_ = cairo_create (_tmp8_);
	cr = _tmp9_;
	_tmp10_ = cr;
	cairo_set_operator (_tmp10_, CAIRO_OPERATOR_SOURCE);
	_tmp11_ = cr;
	_tmp12_ = granite_drawing_buffer_surface_get_surface (self);
	_tmp13_ = _tmp12_;
	cairo_set_source_surface (_tmp11_, _tmp13_, (gdouble) 0, (gdouble) 0);
	_tmp14_ = cr;
	cairo_paint (_tmp14_);
	_tmp15_ = original;
	_tmp16_ = cairo_image_surface_get_data (_tmp15_);
	_data1_->pixels = _tmp16_;
	{
		GThread* th = NULL;
		GThread* _tmp17_;
		guint8* _tmp18_;
		gint _tmp19_;
		gint _tmp20_;
		gint _tmp21_;
		gint _tmp22_;
		gint _tmp23_;
		gint _tmp24_;
		GThread* _tmp25_;
		GThread* _tmp26_;
		GThread* th2 = NULL;
		GThread* _tmp27_;
		guint8* _tmp28_;
		gint _tmp29_;
		gint _tmp30_;
		gint _tmp31_;
		gint _tmp32_;
		gint _tmp33_;
		gint _tmp34_;
		GThread* _tmp35_;
		GThread* _tmp36_;
		_tmp17_ = g_thread_try_new (NULL, ____lambda5__gthread_func, block1_data_ref (_data1_), &_inner_error_);
		th = _tmp17_;
		if (G_UNLIKELY (_inner_error_ != NULL)) {
			goto __catch2_g_error;
		}
		_tmp18_ = _data1_->pixels;
		_tmp19_ = _data1_->width;
		_tmp20_ = _data1_->height;
		_tmp21_ = _data1_->height;
		_tmp22_ = _data1_->height;
		_tmp23_ = _data1_->width;
		_tmp24_ = _data1_->alpha;
		granite_drawing_buffer_surface_exponential_blur_rows (self, _tmp18_, _tmp19_, _tmp20_, _tmp21_ / 2, _tmp22_, 0, _tmp23_, _tmp24_);
		_tmp25_ = th;
		_tmp26_ = _g_thread_ref0 (_tmp25_);
		g_thread_join (_tmp26_);
		_tmp27_ = g_thread_try_new (NULL, ____lambda6__gthread_func, block1_data_ref (_data1_), &_inner_error_);
		th2 = _tmp27_;
		if (G_UNLIKELY (_inner_error_ != NULL)) {
			_g_thread_unref0 (th);
			goto __catch2_g_error;
		}
		_tmp28_ = _data1_->pixels;
		_tmp29_ = _data1_->width;
		_tmp30_ = _data1_->height;
		_tmp31_ = _data1_->width;
		_tmp32_ = _data1_->width;
		_tmp33_ = _data1_->height;
		_tmp34_ = _data1_->alpha;
		granite_drawing_buffer_surface_exponential_blur_columns (self, _tmp28_, _tmp29_, _tmp30_, _tmp31_ / 2, _tmp32_, 0, _tmp33_, _tmp34_);
		_tmp35_ = th2;
		_tmp36_ = _g_thread_ref0 (_tmp35_);
		g_thread_join (_tmp36_);
		_g_thread_unref0 (th2);
		_g_thread_unref0 (th);
	}
	goto __finally2;
	__catch2_g_error:
	{
		GError* err = NULL;
		GError* _tmp37_;
		const gchar* _tmp38_;
		err = _inner_error_;
		_inner_error_ = NULL;
		_tmp37_ = err;
		_tmp38_ = _tmp37_->message;
		g_warning ("BufferSurface.vala:405: %s", _tmp38_);
		_g_error_free0 (err);
	}
	__finally2:
	if (G_UNLIKELY (_inner_error_ != NULL)) {
		_cairo_destroy0 (cr);
		_cairo_surface_destroy0 (original);
		block1_data_unref (_data1_);
		_data1_ = NULL;
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
		g_clear_error (&_inner_error_);
		return;
	}
	_tmp39_ = original;
	cairo_surface_mark_dirty (_tmp39_);
	_tmp40_ = granite_drawing_buffer_surface_get_context (self);
	_tmp41_ = _tmp40_;
	cairo_set_operator (_tmp41_, CAIRO_OPERATOR_SOURCE);
	_tmp42_ = granite_drawing_buffer_surface_get_context (self);
	_tmp43_ = _tmp42_;
	_tmp44_ = original;
	cairo_set_source_surface (_tmp43_, _tmp44_, (gdouble) 0, (gdouble) 0);
	_tmp45_ = granite_drawing_buffer_surface_get_context (self);
	_tmp46_ = _tmp45_;
	cairo_paint (_tmp46_);
	_tmp47_ = granite_drawing_buffer_surface_get_context (self);
	_tmp48_ = _tmp47_;
	cairo_set_operator (_tmp48_, CAIRO_OPERATOR_OVER);
	_cairo_destroy0 (cr);
	_cairo_surface_destroy0 (original);
	block1_data_unref (_data1_);
	_data1_ = NULL;
}


static void granite_drawing_buffer_surface_exponential_blur_columns (GraniteDrawingBufferSurface* self, guint8* pixels, gint width, gint height, gint startCol, gint endCol, gint startY, gint endY, gint alpha) {
	g_return_if_fail (self != NULL);
	{
		gint columnIndex = 0;
		gint _tmp0_;
		_tmp0_ = startCol;
		columnIndex = _tmp0_;
		{
			gboolean _tmp1_ = FALSE;
			_tmp1_ = TRUE;
			while (TRUE) {
				gint _tmp3_;
				gint _tmp4_;
				guint8* column = NULL;
				guint8* _tmp5_;
				gint _tmp6_;
				gint zA = 0;
				guint8* _tmp7_;
				guint8 _tmp8_;
				gint zR = 0;
				guint8* _tmp9_;
				guint8 _tmp10_;
				gint zG = 0;
				guint8* _tmp11_;
				guint8 _tmp12_;
				gint zB = 0;
				guint8* _tmp13_;
				guint8 _tmp14_;
				if (!_tmp1_) {
					gint _tmp2_;
					_tmp2_ = columnIndex;
					columnIndex = _tmp2_ + 1;
				}
				_tmp1_ = FALSE;
				_tmp3_ = columnIndex;
				_tmp4_ = endCol;
				if (!(_tmp3_ < _tmp4_)) {
					break;
				}
				_tmp5_ = pixels;
				_tmp6_ = columnIndex;
				column = _tmp5_ + (_tmp6_ * 4);
				_tmp7_ = column;
				_tmp8_ = _tmp7_[0];
				zA = _tmp8_ << GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision;
				_tmp9_ = column;
				_tmp10_ = _tmp9_[1];
				zR = _tmp10_ << GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision;
				_tmp11_ = column;
				_tmp12_ = _tmp11_[2];
				zG = _tmp12_ << GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision;
				_tmp13_ = column;
				_tmp14_ = _tmp13_[3];
				zB = _tmp14_ << GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision;
				{
					gint index = 0;
					gint _tmp15_;
					gint _tmp16_;
					_tmp15_ = width;
					_tmp16_ = startY;
					index = _tmp15_ * (_tmp16_ + 1);
					{
						gboolean _tmp17_ = FALSE;
						_tmp17_ = TRUE;
						while (TRUE) {
							gint _tmp20_;
							gint _tmp21_;
							gint _tmp22_;
							guint8* _tmp23_;
							gint _tmp24_;
							gint _tmp25_;
							if (!_tmp17_) {
								gint _tmp18_;
								gint _tmp19_;
								_tmp18_ = index;
								_tmp19_ = width;
								index = _tmp18_ + _tmp19_;
							}
							_tmp17_ = FALSE;
							_tmp20_ = index;
							_tmp21_ = endY;
							_tmp22_ = width;
							if (!(_tmp20_ < ((_tmp21_ - 1) * _tmp22_))) {
								break;
							}
							_tmp23_ = column;
							_tmp24_ = index;
							_tmp25_ = alpha;
							granite_drawing_buffer_surface_exponential_blur_inner (&_tmp23_[_tmp24_ * 4], &zA, &zR, &zG, &zB, _tmp25_);
						}
					}
				}
				{
					gint index = 0;
					gint _tmp26_;
					gint _tmp27_;
					_tmp26_ = endY;
					_tmp27_ = width;
					index = (_tmp26_ - 2) * _tmp27_;
					{
						gboolean _tmp28_ = FALSE;
						_tmp28_ = TRUE;
						while (TRUE) {
							gint _tmp31_;
							gint _tmp32_;
							guint8* _tmp33_;
							gint _tmp34_;
							gint _tmp35_;
							if (!_tmp28_) {
								gint _tmp29_;
								gint _tmp30_;
								_tmp29_ = index;
								_tmp30_ = width;
								index = _tmp29_ - _tmp30_;
							}
							_tmp28_ = FALSE;
							_tmp31_ = index;
							_tmp32_ = startY;
							if (!(_tmp31_ >= _tmp32_)) {
								break;
							}
							_tmp33_ = column;
							_tmp34_ = index;
							_tmp35_ = alpha;
							granite_drawing_buffer_surface_exponential_blur_inner (&_tmp33_[_tmp34_ * 4], &zA, &zR, &zG, &zB, _tmp35_);
						}
					}
				}
			}
		}
	}
}


static void granite_drawing_buffer_surface_exponential_blur_rows (GraniteDrawingBufferSurface* self, guint8* pixels, gint width, gint height, gint startRow, gint endRow, gint startX, gint endX, gint alpha) {
	g_return_if_fail (self != NULL);
	{
		gint rowIndex = 0;
		gint _tmp0_;
		_tmp0_ = startRow;
		rowIndex = _tmp0_;
		{
			gboolean _tmp1_ = FALSE;
			_tmp1_ = TRUE;
			while (TRUE) {
				gint _tmp3_;
				gint _tmp4_;
				guint8* row = NULL;
				guint8* _tmp5_;
				gint _tmp6_;
				gint _tmp7_;
				gint zA = 0;
				guint8* _tmp8_;
				gint _tmp9_;
				guint8 _tmp10_;
				gint zR = 0;
				guint8* _tmp11_;
				gint _tmp12_;
				guint8 _tmp13_;
				gint zG = 0;
				guint8* _tmp14_;
				gint _tmp15_;
				guint8 _tmp16_;
				gint zB = 0;
				guint8* _tmp17_;
				gint _tmp18_;
				guint8 _tmp19_;
				if (!_tmp1_) {
					gint _tmp2_;
					_tmp2_ = rowIndex;
					rowIndex = _tmp2_ + 1;
				}
				_tmp1_ = FALSE;
				_tmp3_ = rowIndex;
				_tmp4_ = endRow;
				if (!(_tmp3_ < _tmp4_)) {
					break;
				}
				_tmp5_ = pixels;
				_tmp6_ = rowIndex;
				_tmp7_ = width;
				row = _tmp5_ + ((_tmp6_ * _tmp7_) * 4);
				_tmp8_ = row;
				_tmp9_ = startX;
				_tmp10_ = _tmp8_[_tmp9_ + 0];
				zA = _tmp10_ << GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision;
				_tmp11_ = row;
				_tmp12_ = startX;
				_tmp13_ = _tmp11_[_tmp12_ + 1];
				zR = _tmp13_ << GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision;
				_tmp14_ = row;
				_tmp15_ = startX;
				_tmp16_ = _tmp14_[_tmp15_ + 2];
				zG = _tmp16_ << GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision;
				_tmp17_ = row;
				_tmp18_ = startX;
				_tmp19_ = _tmp17_[_tmp18_ + 3];
				zB = _tmp19_ << GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision;
				{
					gint index = 0;
					gint _tmp20_;
					_tmp20_ = startX;
					index = _tmp20_ + 1;
					{
						gboolean _tmp21_ = FALSE;
						_tmp21_ = TRUE;
						while (TRUE) {
							gint _tmp23_;
							gint _tmp24_;
							guint8* _tmp25_;
							gint _tmp26_;
							gint _tmp27_;
							if (!_tmp21_) {
								gint _tmp22_;
								_tmp22_ = index;
								index = _tmp22_ + 1;
							}
							_tmp21_ = FALSE;
							_tmp23_ = index;
							_tmp24_ = endX;
							if (!(_tmp23_ < _tmp24_)) {
								break;
							}
							_tmp25_ = row;
							_tmp26_ = index;
							_tmp27_ = alpha;
							granite_drawing_buffer_surface_exponential_blur_inner (&_tmp25_[_tmp26_ * 4], &zA, &zR, &zG, &zB, _tmp27_);
						}
					}
				}
				{
					gint index = 0;
					gint _tmp28_;
					_tmp28_ = endX;
					index = _tmp28_ - 2;
					{
						gboolean _tmp29_ = FALSE;
						_tmp29_ = TRUE;
						while (TRUE) {
							gint _tmp31_;
							gint _tmp32_;
							guint8* _tmp33_;
							gint _tmp34_;
							gint _tmp35_;
							if (!_tmp29_) {
								gint _tmp30_;
								_tmp30_ = index;
								index = _tmp30_ - 1;
							}
							_tmp29_ = FALSE;
							_tmp31_ = index;
							_tmp32_ = startX;
							if (!(_tmp31_ >= _tmp32_)) {
								break;
							}
							_tmp33_ = row;
							_tmp34_ = index;
							_tmp35_ = alpha;
							granite_drawing_buffer_surface_exponential_blur_inner (&_tmp33_[_tmp34_ * 4], &zA, &zR, &zG, &zB, _tmp35_);
						}
					}
				}
			}
		}
	}
}


static inline void granite_drawing_buffer_surface_exponential_blur_inner (guint8* pixel, gint* zA, gint* zR, gint* zG, gint* zB, gint alpha) {
	gint _tmp0_;
	gint _tmp1_;
	guint8* _tmp2_;
	guint8 _tmp3_;
	gint _tmp4_;
	gint _tmp5_;
	gint _tmp6_;
	guint8* _tmp7_;
	guint8 _tmp8_;
	gint _tmp9_;
	gint _tmp10_;
	gint _tmp11_;
	guint8* _tmp12_;
	guint8 _tmp13_;
	gint _tmp14_;
	gint _tmp15_;
	gint _tmp16_;
	guint8* _tmp17_;
	guint8 _tmp18_;
	gint _tmp19_;
	guint8* _tmp20_;
	gint _tmp21_;
	guint8 _tmp22_;
	guint8* _tmp23_;
	gint _tmp24_;
	guint8 _tmp25_;
	guint8* _tmp26_;
	gint _tmp27_;
	guint8 _tmp28_;
	guint8* _tmp29_;
	gint _tmp30_;
	guint8 _tmp31_;
	_tmp0_ = *zA;
	_tmp1_ = alpha;
	_tmp2_ = pixel;
	_tmp3_ = _tmp2_[0];
	_tmp4_ = *zA;
	*zA = _tmp0_ + ((_tmp1_ * ((_tmp3_ << GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision) - _tmp4_)) >> GRANITE_DRAWING_BUFFER_SURFACE_AlphaPrecision);
	_tmp5_ = *zR;
	_tmp6_ = alpha;
	_tmp7_ = pixel;
	_tmp8_ = _tmp7_[1];
	_tmp9_ = *zR;
	*zR = _tmp5_ + ((_tmp6_ * ((_tmp8_ << GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision) - _tmp9_)) >> GRANITE_DRAWING_BUFFER_SURFACE_AlphaPrecision);
	_tmp10_ = *zG;
	_tmp11_ = alpha;
	_tmp12_ = pixel;
	_tmp13_ = _tmp12_[2];
	_tmp14_ = *zG;
	*zG = _tmp10_ + ((_tmp11_ * ((_tmp13_ << GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision) - _tmp14_)) >> GRANITE_DRAWING_BUFFER_SURFACE_AlphaPrecision);
	_tmp15_ = *zB;
	_tmp16_ = alpha;
	_tmp17_ = pixel;
	_tmp18_ = _tmp17_[3];
	_tmp19_ = *zB;
	*zB = _tmp15_ + ((_tmp16_ * ((_tmp18_ << GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision) - _tmp19_)) >> GRANITE_DRAWING_BUFFER_SURFACE_AlphaPrecision);
	_tmp20_ = pixel;
	_tmp21_ = *zA;
	_tmp20_[0] = (guint8) (_tmp21_ >> GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision);
	_tmp22_ = _tmp20_[0];
	_tmp23_ = pixel;
	_tmp24_ = *zR;
	_tmp23_[1] = (guint8) (_tmp24_ >> GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision);
	_tmp25_ = _tmp23_[1];
	_tmp26_ = pixel;
	_tmp27_ = *zG;
	_tmp26_[2] = (guint8) (_tmp27_ >> GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision);
	_tmp28_ = _tmp26_[2];
	_tmp29_ = pixel;
	_tmp30_ = *zB;
	_tmp29_[3] = (guint8) (_tmp30_ >> GRANITE_DRAWING_BUFFER_SURFACE_ParamPrecision);
	_tmp31_ = _tmp29_[3];
}


/**
         * Performs a blur operation on the internal {@link Cairo.Surface}, using a
         * gaussian blurring algorithm. This method is very slow, albeit producing
         * debatably the best-looking results, and in most cases developers should
         * use the exponential blurring algorithm instead.
         *
         * @param radius the blur radius
         */
static Block2Data* block2_data_ref (Block2Data* _data2_) {
	g_atomic_int_inc (&_data2_->_ref_count_);
	return _data2_;
}


static void block2_data_unref (void * _userdata_) {
	Block2Data* _data2_;
	_data2_ = (Block2Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data2_->_ref_count_)) {
		GraniteDrawingBufferSurface* self;
		self = _data2_->self;
		_data2_->shiftar = (g_free (_data2_->shiftar), NULL);
		_data2_->bbuffer = (g_free (_data2_->bbuffer), NULL);
		_data2_->abuffer = (g_free (_data2_->abuffer), NULL);
		_data2_->kernel = (g_free (_data2_->kernel), NULL);
		_g_object_unref0 (self);
		g_slice_free (Block2Data, _data2_);
	}
}


static void* ___lambda7_ (Block2Data* _data2_) {
	GraniteDrawingBufferSurface* self;
	void* result = NULL;
	gdouble* _tmp0_;
	gint _tmp0__length1;
	gdouble* _tmp1_;
	gint _tmp1__length1;
	gdouble* _tmp2_;
	gint _tmp2__length1;
	gint _tmp3_;
	gint _tmp4_;
	gint _tmp5_;
	gint _tmp6_;
	gint* _tmp7_;
	gint _tmp7__length1;
	gint _tmp7__length2;
	self = _data2_->self;
	_tmp0_ = _data2_->abuffer;
	_tmp0__length1 = _data2_->abuffer_length1;
	_tmp1_ = _data2_->bbuffer;
	_tmp1__length1 = _data2_->bbuffer_length1;
	_tmp2_ = _data2_->kernel;
	_tmp2__length1 = _data2_->kernel_length1;
	_tmp3_ = _data2_->gausswidth;
	_tmp4_ = _data2_->width;
	_tmp5_ = _data2_->height;
	_tmp6_ = _data2_->height;
	_tmp7_ = _data2_->shiftar;
	_tmp7__length1 = _data2_->shiftar_length1;
	_tmp7__length2 = _data2_->shiftar_length2;
	granite_drawing_buffer_surface_gaussian_blur_horizontal (self, _tmp0_, _tmp1_, _tmp2_, _tmp3_, _tmp4_, _tmp5_, 0, _tmp6_ / 2, _tmp7_, _tmp7__length1, _tmp7__length2);
	result = NULL;
	return result;
}


static gpointer ____lambda7__gthread_func (gpointer self) {
	gpointer result;
	result = ___lambda7_ (self);
	block2_data_unref (self);
	return result;
}


static void* ___lambda8_ (Block2Data* _data2_) {
	GraniteDrawingBufferSurface* self;
	void* result = NULL;
	gdouble* _tmp0_;
	gint _tmp0__length1;
	gdouble* _tmp1_;
	gint _tmp1__length1;
	gdouble* _tmp2_;
	gint _tmp2__length1;
	gint _tmp3_;
	gint _tmp4_;
	gint _tmp5_;
	gint _tmp6_;
	gint* _tmp7_;
	gint _tmp7__length1;
	gint _tmp7__length2;
	self = _data2_->self;
	_tmp0_ = _data2_->bbuffer;
	_tmp0__length1 = _data2_->bbuffer_length1;
	_tmp1_ = _data2_->abuffer;
	_tmp1__length1 = _data2_->abuffer_length1;
	_tmp2_ = _data2_->kernel;
	_tmp2__length1 = _data2_->kernel_length1;
	_tmp3_ = _data2_->gausswidth;
	_tmp4_ = _data2_->width;
	_tmp5_ = _data2_->height;
	_tmp6_ = _data2_->width;
	_tmp7_ = _data2_->shiftar;
	_tmp7__length1 = _data2_->shiftar_length1;
	_tmp7__length2 = _data2_->shiftar_length2;
	granite_drawing_buffer_surface_gaussian_blur_vertical (self, _tmp0_, _tmp1_, _tmp2_, _tmp3_, _tmp4_, _tmp5_, 0, _tmp6_ / 2, _tmp7_, _tmp7__length1, _tmp7__length2);
	result = NULL;
	return result;
}


static gpointer ____lambda8__gthread_func (gpointer self) {
	gpointer result;
	result = ___lambda8_ (self);
	block2_data_unref (self);
	return result;
}


void granite_drawing_buffer_surface_gaussian_blur (GraniteDrawingBufferSurface* self, gint radius) {
	Block2Data* _data2_;
	gint _tmp0_;
	gint _tmp1_;
	gint _tmp2_;
	gdouble* _tmp3_;
	gint _tmp4_;
	gint _tmp5_;
	cairo_surface_t* original = NULL;
	gint _tmp6_;
	gint _tmp7_;
	cairo_surface_t* _tmp8_;
	cairo_t* cr = NULL;
	cairo_surface_t* _tmp9_;
	cairo_t* _tmp10_;
	cairo_t* _tmp11_;
	cairo_t* _tmp12_;
	cairo_surface_t* _tmp13_;
	cairo_surface_t* _tmp14_;
	cairo_t* _tmp15_;
	guint8* src = NULL;
	cairo_surface_t* _tmp16_;
	guchar* _tmp17_;
	gint size = 0;
	gint _tmp18_;
	cairo_surface_t* _tmp19_;
	gint _tmp20_;
	gint _tmp21_;
	gdouble* _tmp22_;
	gint _tmp23_;
	gdouble* _tmp24_;
	gint _tmp35_;
	gint _tmp36_;
	gint _tmp37_;
	gint _tmp38_;
	gint* _tmp39_;
	cairo_surface_t* _tmp134_;
	cairo_t* _tmp135_;
	cairo_t* _tmp136_;
	cairo_t* _tmp137_;
	cairo_t* _tmp138_;
	cairo_surface_t* _tmp139_;
	cairo_t* _tmp140_;
	cairo_t* _tmp141_;
	cairo_t* _tmp142_;
	cairo_t* _tmp143_;
	GError * _inner_error_ = NULL;
	g_return_if_fail (self != NULL);
	_data2_ = g_slice_new0 (Block2Data);
	_data2_->_ref_count_ = 1;
	_data2_->self = g_object_ref (self);
	_tmp0_ = radius;
	_data2_->gausswidth = (_tmp0_ * 2) + 1;
	_tmp1_ = _data2_->gausswidth;
	_tmp3_ = granite_drawing_buffer_surface_build_gaussian_kernel (_tmp1_, &_tmp2_);
	_data2_->kernel = _tmp3_;
	_data2_->kernel_length1 = _tmp2_;
	_data2_->_kernel_size_ = _data2_->kernel_length1;
	_tmp4_ = self->priv->_width;
	_data2_->width = _tmp4_;
	_tmp5_ = self->priv->_height;
	_data2_->height = _tmp5_;
	_tmp6_ = _data2_->width;
	_tmp7_ = _data2_->height;
	_tmp8_ = cairo_image_surface_create (CAIRO_FORMAT_ARGB32, _tmp6_, _tmp7_);
	original = _tmp8_;
	_tmp9_ = original;
	_tmp10_ = cairo_create (_tmp9_);
	cr = _tmp10_;
	_tmp11_ = cr;
	cairo_set_operator (_tmp11_, CAIRO_OPERATOR_SOURCE);
	_tmp12_ = cr;
	_tmp13_ = granite_drawing_buffer_surface_get_surface (self);
	_tmp14_ = _tmp13_;
	cairo_set_source_surface (_tmp12_, _tmp14_, (gdouble) 0, (gdouble) 0);
	_tmp15_ = cr;
	cairo_paint (_tmp15_);
	_tmp16_ = original;
	_tmp17_ = cairo_image_surface_get_data (_tmp16_);
	src = _tmp17_;
	_tmp18_ = _data2_->height;
	_tmp19_ = original;
	_tmp20_ = cairo_image_surface_get_stride (_tmp19_);
	size = _tmp18_ * _tmp20_;
	_tmp21_ = size;
	_tmp22_ = g_new0 (gdouble, _tmp21_);
	_data2_->abuffer = _tmp22_;
	_data2_->abuffer_length1 = _tmp21_;
	_data2_->_abuffer_size_ = _data2_->abuffer_length1;
	_tmp23_ = size;
	_tmp24_ = g_new0 (gdouble, _tmp23_);
	_data2_->bbuffer = _tmp24_;
	_data2_->bbuffer_length1 = _tmp23_;
	_data2_->_bbuffer_size_ = _data2_->bbuffer_length1;
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp25_ = FALSE;
			_tmp25_ = TRUE;
			while (TRUE) {
				gint _tmp27_;
				gint _tmp28_;
				gdouble* _tmp29_;
				gint _tmp29__length1;
				gint _tmp30_;
				guint8* _tmp31_;
				gint _tmp32_;
				guint8 _tmp33_;
				gdouble _tmp34_;
				if (!_tmp25_) {
					gint _tmp26_;
					_tmp26_ = i;
					i = _tmp26_ + 1;
				}
				_tmp25_ = FALSE;
				_tmp27_ = i;
				_tmp28_ = size;
				if (!(_tmp27_ < _tmp28_)) {
					break;
				}
				_tmp29_ = _data2_->abuffer;
				_tmp29__length1 = _data2_->abuffer_length1;
				_tmp30_ = i;
				_tmp31_ = src;
				_tmp32_ = i;
				_tmp33_ = _tmp31_[_tmp32_];
				_tmp29_[_tmp30_] = (gdouble) _tmp33_;
				_tmp34_ = _tmp29_[_tmp30_];
			}
		}
	}
	_tmp35_ = _data2_->width;
	_tmp36_ = _data2_->height;
	_tmp37_ = MAX (_tmp35_, _tmp36_);
	_tmp38_ = _data2_->gausswidth;
	_tmp39_ = g_new0 (gint, _tmp37_ * _tmp38_);
	_data2_->shiftar = _tmp39_;
	_data2_->shiftar_length1 = _tmp37_;
	_data2_->shiftar_length2 = _tmp38_;
	{
		gint x = 0;
		x = 0;
		{
			gboolean _tmp40_ = FALSE;
			_tmp40_ = TRUE;
			while (TRUE) {
				gint _tmp42_;
				gint _tmp43_;
				if (!_tmp40_) {
					gint _tmp41_;
					_tmp41_ = x;
					x = _tmp41_ + 1;
				}
				_tmp40_ = FALSE;
				_tmp42_ = x;
				_tmp43_ = _data2_->width;
				if (!(_tmp42_ < _tmp43_)) {
					break;
				}
				{
					gint k = 0;
					k = 0;
					{
						gboolean _tmp44_ = FALSE;
						_tmp44_ = TRUE;
						while (TRUE) {
							gint _tmp46_;
							gint _tmp47_;
							gint shift = 0;
							gint _tmp48_;
							gint _tmp49_;
							gboolean _tmp50_ = FALSE;
							gint _tmp51_;
							gint _tmp52_;
							if (!_tmp44_) {
								gint _tmp45_;
								_tmp45_ = k;
								k = _tmp45_ + 1;
							}
							_tmp44_ = FALSE;
							_tmp46_ = k;
							_tmp47_ = _data2_->gausswidth;
							if (!(_tmp46_ < _tmp47_)) {
								break;
							}
							_tmp48_ = k;
							_tmp49_ = radius;
							shift = _tmp48_ - _tmp49_;
							_tmp51_ = x;
							_tmp52_ = shift;
							if ((_tmp51_ + _tmp52_) <= 0) {
								_tmp50_ = TRUE;
							} else {
								gint _tmp53_;
								gint _tmp54_;
								gint _tmp55_;
								_tmp53_ = x;
								_tmp54_ = shift;
								_tmp55_ = _data2_->width;
								_tmp50_ = (_tmp53_ + _tmp54_) >= _tmp55_;
							}
							if (_tmp50_) {
								gint* _tmp56_;
								gint _tmp56__length1;
								gint _tmp56__length2;
								gint _tmp57_;
								gint _tmp58_;
								gint _tmp59_;
								_tmp56_ = _data2_->shiftar;
								_tmp56__length1 = _data2_->shiftar_length1;
								_tmp56__length2 = _data2_->shiftar_length2;
								_tmp57_ = x;
								_tmp58_ = k;
								_tmp56_[(_tmp57_ * _tmp56__length2) + _tmp58_] = 0;
								_tmp59_ = _tmp56_[(_tmp57_ * _tmp56__length2) + _tmp58_];
							} else {
								gint* _tmp60_;
								gint _tmp60__length1;
								gint _tmp60__length2;
								gint _tmp61_;
								gint _tmp62_;
								gint _tmp63_;
								gint _tmp64_;
								_tmp60_ = _data2_->shiftar;
								_tmp60__length1 = _data2_->shiftar_length1;
								_tmp60__length2 = _data2_->shiftar_length2;
								_tmp61_ = x;
								_tmp62_ = k;
								_tmp63_ = shift;
								_tmp60_[(_tmp61_ * _tmp60__length2) + _tmp62_] = _tmp63_ * 4;
								_tmp64_ = _tmp60_[(_tmp61_ * _tmp60__length2) + _tmp62_];
							}
						}
					}
				}
			}
		}
	}
	{
		GThread* th = NULL;
		GThread* _tmp65_;
		gdouble* _tmp66_;
		gint _tmp66__length1;
		gdouble* _tmp67_;
		gint _tmp67__length1;
		gdouble* _tmp68_;
		gint _tmp68__length1;
		gint _tmp69_;
		gint _tmp70_;
		gint _tmp71_;
		gint _tmp72_;
		gint _tmp73_;
		gint* _tmp74_;
		gint _tmp74__length1;
		gint _tmp74__length2;
		GThread* _tmp75_;
		GThread* _tmp76_;
		gdouble* _tmp77_;
		gint _tmp77__length1;
		gint _tmp78_;
		gint _tmp79_;
		gint _tmp80_;
		gint _tmp81_;
		gint _tmp82_;
		gint* _tmp83_;
		GThread* th2 = NULL;
		GThread* _tmp110_;
		gdouble* _tmp111_;
		gint _tmp111__length1;
		gdouble* _tmp112_;
		gint _tmp112__length1;
		gdouble* _tmp113_;
		gint _tmp113__length1;
		gint _tmp114_;
		gint _tmp115_;
		gint _tmp116_;
		gint _tmp117_;
		gint _tmp118_;
		gint* _tmp119_;
		gint _tmp119__length1;
		gint _tmp119__length2;
		GThread* _tmp120_;
		GThread* _tmp121_;
		_tmp65_ = g_thread_try_new (NULL, ____lambda7__gthread_func, block2_data_ref (_data2_), &_inner_error_);
		th = _tmp65_;
		if (G_UNLIKELY (_inner_error_ != NULL)) {
			goto __catch3_g_error;
		}
		_tmp66_ = _data2_->abuffer;
		_tmp66__length1 = _data2_->abuffer_length1;
		_tmp67_ = _data2_->bbuffer;
		_tmp67__length1 = _data2_->bbuffer_length1;
		_tmp68_ = _data2_->kernel;
		_tmp68__length1 = _data2_->kernel_length1;
		_tmp69_ = _data2_->gausswidth;
		_tmp70_ = _data2_->width;
		_tmp71_ = _data2_->height;
		_tmp72_ = _data2_->height;
		_tmp73_ = _data2_->height;
		_tmp74_ = _data2_->shiftar;
		_tmp74__length1 = _data2_->shiftar_length1;
		_tmp74__length2 = _data2_->shiftar_length2;
		granite_drawing_buffer_surface_gaussian_blur_horizontal (self, _tmp66_, _tmp67_, _tmp68_, _tmp69_, _tmp70_, _tmp71_, _tmp72_ / 2, _tmp73_, _tmp74_, _tmp74__length1, _tmp74__length2);
		_tmp75_ = th;
		_tmp76_ = _g_thread_ref0 (_tmp75_);
		g_thread_join (_tmp76_);
		_tmp77_ = _data2_->abuffer;
		_tmp77__length1 = _data2_->abuffer_length1;
		_tmp78_ = size;
		memset (_tmp77_, 0, (gsize) (sizeof (gdouble) * _tmp78_));
		_tmp79_ = _data2_->width;
		_tmp80_ = _data2_->height;
		_tmp81_ = MAX (_tmp79_, _tmp80_);
		_tmp82_ = _data2_->gausswidth;
		_tmp83_ = g_new0 (gint, _tmp81_ * _tmp82_);
		_data2_->shiftar = (g_free (_data2_->shiftar), NULL);
		_data2_->shiftar = _tmp83_;
		_data2_->shiftar_length1 = _tmp81_;
		_data2_->shiftar_length2 = _tmp82_;
		{
			gint y = 0;
			y = 0;
			{
				gboolean _tmp84_ = FALSE;
				_tmp84_ = TRUE;
				while (TRUE) {
					gint _tmp86_;
					gint _tmp87_;
					if (!_tmp84_) {
						gint _tmp85_;
						_tmp85_ = y;
						y = _tmp85_ + 1;
					}
					_tmp84_ = FALSE;
					_tmp86_ = y;
					_tmp87_ = _data2_->height;
					if (!(_tmp86_ < _tmp87_)) {
						break;
					}
					{
						gint k = 0;
						k = 0;
						{
							gboolean _tmp88_ = FALSE;
							_tmp88_ = TRUE;
							while (TRUE) {
								gint _tmp90_;
								gint _tmp91_;
								gint shift = 0;
								gint _tmp92_;
								gint _tmp93_;
								gboolean _tmp94_ = FALSE;
								gint _tmp95_;
								gint _tmp96_;
								if (!_tmp88_) {
									gint _tmp89_;
									_tmp89_ = k;
									k = _tmp89_ + 1;
								}
								_tmp88_ = FALSE;
								_tmp90_ = k;
								_tmp91_ = _data2_->gausswidth;
								if (!(_tmp90_ < _tmp91_)) {
									break;
								}
								_tmp92_ = k;
								_tmp93_ = radius;
								shift = _tmp92_ - _tmp93_;
								_tmp95_ = y;
								_tmp96_ = shift;
								if ((_tmp95_ + _tmp96_) <= 0) {
									_tmp94_ = TRUE;
								} else {
									gint _tmp97_;
									gint _tmp98_;
									gint _tmp99_;
									_tmp97_ = y;
									_tmp98_ = shift;
									_tmp99_ = _data2_->height;
									_tmp94_ = (_tmp97_ + _tmp98_) >= _tmp99_;
								}
								if (_tmp94_) {
									gint* _tmp100_;
									gint _tmp100__length1;
									gint _tmp100__length2;
									gint _tmp101_;
									gint _tmp102_;
									gint _tmp103_;
									_tmp100_ = _data2_->shiftar;
									_tmp100__length1 = _data2_->shiftar_length1;
									_tmp100__length2 = _data2_->shiftar_length2;
									_tmp101_ = y;
									_tmp102_ = k;
									_tmp100_[(_tmp101_ * _tmp100__length2) + _tmp102_] = 0;
									_tmp103_ = _tmp100_[(_tmp101_ * _tmp100__length2) + _tmp102_];
								} else {
									gint* _tmp104_;
									gint _tmp104__length1;
									gint _tmp104__length2;
									gint _tmp105_;
									gint _tmp106_;
									gint _tmp107_;
									gint _tmp108_;
									gint _tmp109_;
									_tmp104_ = _data2_->shiftar;
									_tmp104__length1 = _data2_->shiftar_length1;
									_tmp104__length2 = _data2_->shiftar_length2;
									_tmp105_ = y;
									_tmp106_ = k;
									_tmp107_ = shift;
									_tmp108_ = _data2_->width;
									_tmp104_[(_tmp105_ * _tmp104__length2) + _tmp106_] = (_tmp107_ * _tmp108_) * 4;
									_tmp109_ = _tmp104_[(_tmp105_ * _tmp104__length2) + _tmp106_];
								}
							}
						}
					}
				}
			}
		}
		_tmp110_ = g_thread_try_new (NULL, ____lambda8__gthread_func, block2_data_ref (_data2_), &_inner_error_);
		th2 = _tmp110_;
		if (G_UNLIKELY (_inner_error_ != NULL)) {
			_g_thread_unref0 (th);
			goto __catch3_g_error;
		}
		_tmp111_ = _data2_->bbuffer;
		_tmp111__length1 = _data2_->bbuffer_length1;
		_tmp112_ = _data2_->abuffer;
		_tmp112__length1 = _data2_->abuffer_length1;
		_tmp113_ = _data2_->kernel;
		_tmp113__length1 = _data2_->kernel_length1;
		_tmp114_ = _data2_->gausswidth;
		_tmp115_ = _data2_->width;
		_tmp116_ = _data2_->height;
		_tmp117_ = _data2_->width;
		_tmp118_ = _data2_->width;
		_tmp119_ = _data2_->shiftar;
		_tmp119__length1 = _data2_->shiftar_length1;
		_tmp119__length2 = _data2_->shiftar_length2;
		granite_drawing_buffer_surface_gaussian_blur_vertical (self, _tmp111_, _tmp112_, _tmp113_, _tmp114_, _tmp115_, _tmp116_, _tmp117_ / 2, _tmp118_, _tmp119_, _tmp119__length1, _tmp119__length2);
		_tmp120_ = th2;
		_tmp121_ = _g_thread_ref0 (_tmp120_);
		g_thread_join (_tmp121_);
		_g_thread_unref0 (th2);
		_g_thread_unref0 (th);
	}
	goto __finally3;
	__catch3_g_error:
	{
		GError* err = NULL;
		GError* _tmp122_;
		const gchar* _tmp123_;
		err = _inner_error_;
		_inner_error_ = NULL;
		_tmp122_ = err;
		_tmp123_ = _tmp122_->message;
		g_message ("BufferSurface.vala:549: %s", _tmp123_);
		_g_error_free0 (err);
	}
	__finally3:
	if (G_UNLIKELY (_inner_error_ != NULL)) {
		_cairo_destroy0 (cr);
		_cairo_surface_destroy0 (original);
		block2_data_unref (_data2_);
		_data2_ = NULL;
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
		g_clear_error (&_inner_error_);
		return;
	}
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp124_ = FALSE;
			_tmp124_ = TRUE;
			while (TRUE) {
				gint _tmp126_;
				gint _tmp127_;
				guint8* _tmp128_;
				gint _tmp129_;
				gdouble* _tmp130_;
				gint _tmp130__length1;
				gint _tmp131_;
				gdouble _tmp132_;
				guint8 _tmp133_;
				if (!_tmp124_) {
					gint _tmp125_;
					_tmp125_ = i;
					i = _tmp125_ + 1;
				}
				_tmp124_ = FALSE;
				_tmp126_ = i;
				_tmp127_ = size;
				if (!(_tmp126_ < _tmp127_)) {
					break;
				}
				_tmp128_ = src;
				_tmp129_ = i;
				_tmp130_ = _data2_->abuffer;
				_tmp130__length1 = _data2_->abuffer_length1;
				_tmp131_ = i;
				_tmp132_ = _tmp130_[_tmp131_];
				_tmp128_[_tmp129_] = (guint8) _tmp132_;
				_tmp133_ = _tmp128_[_tmp129_];
			}
		}
	}
	_tmp134_ = original;
	cairo_surface_mark_dirty (_tmp134_);
	_tmp135_ = granite_drawing_buffer_surface_get_context (self);
	_tmp136_ = _tmp135_;
	cairo_set_operator (_tmp136_, CAIRO_OPERATOR_SOURCE);
	_tmp137_ = granite_drawing_buffer_surface_get_context (self);
	_tmp138_ = _tmp137_;
	_tmp139_ = original;
	cairo_set_source_surface (_tmp138_, _tmp139_, (gdouble) 0, (gdouble) 0);
	_tmp140_ = granite_drawing_buffer_surface_get_context (self);
	_tmp141_ = _tmp140_;
	cairo_paint (_tmp141_);
	_tmp142_ = granite_drawing_buffer_surface_get_context (self);
	_tmp143_ = _tmp142_;
	cairo_set_operator (_tmp143_, CAIRO_OPERATOR_OVER);
	_cairo_destroy0 (cr);
	_cairo_surface_destroy0 (original);
	block2_data_unref (_data2_);
	_data2_ = NULL;
}


static void granite_drawing_buffer_surface_gaussian_blur_horizontal (GraniteDrawingBufferSurface* self, gdouble* src, gdouble* dest, gdouble* kernel, gint gausswidth, gint width, gint height, gint startRow, gint endRow, gint* shift, int shift_length1, int shift_length2) {
	guint32 cur_pixel = 0U;
	gint _tmp0_;
	gint _tmp1_;
	g_return_if_fail (self != NULL);
	_tmp0_ = startRow;
	_tmp1_ = width;
	cur_pixel = (guint32) ((_tmp0_ * _tmp1_) * 4);
	{
		gint y = 0;
		gint _tmp2_;
		_tmp2_ = startRow;
		y = _tmp2_;
		{
			gboolean _tmp3_ = FALSE;
			_tmp3_ = TRUE;
			while (TRUE) {
				gint _tmp5_;
				gint _tmp6_;
				if (!_tmp3_) {
					gint _tmp4_;
					_tmp4_ = y;
					y = _tmp4_ + 1;
				}
				_tmp3_ = FALSE;
				_tmp5_ = y;
				_tmp6_ = endRow;
				if (!(_tmp5_ < _tmp6_)) {
					break;
				}
				{
					gint x = 0;
					x = 0;
					{
						gboolean _tmp7_ = FALSE;
						_tmp7_ = TRUE;
						while (TRUE) {
							gint _tmp9_;
							gint _tmp10_;
							guint32 _tmp56_;
							if (!_tmp7_) {
								gint _tmp8_;
								_tmp8_ = x;
								x = _tmp8_ + 1;
							}
							_tmp7_ = FALSE;
							_tmp9_ = x;
							_tmp10_ = width;
							if (!(_tmp9_ < _tmp10_)) {
								break;
							}
							{
								gint k = 0;
								k = 0;
								{
									gboolean _tmp11_ = FALSE;
									_tmp11_ = TRUE;
									while (TRUE) {
										gint _tmp13_;
										gint _tmp14_;
										guint32 source = 0U;
										guint32 _tmp15_;
										gint* _tmp16_;
										gint _tmp16__length1;
										gint _tmp16__length2;
										gint _tmp17_;
										gint _tmp18_;
										gint _tmp19_;
										gdouble* _tmp20_;
										guint32 _tmp21_;
										gdouble* _tmp22_;
										guint32 _tmp23_;
										gdouble _tmp24_;
										gdouble* _tmp25_;
										gint _tmp26_;
										gdouble _tmp27_;
										gdouble _tmp28_;
										gdouble* _tmp29_;
										guint32 _tmp30_;
										gdouble* _tmp31_;
										guint32 _tmp32_;
										gdouble _tmp33_;
										gdouble* _tmp34_;
										gint _tmp35_;
										gdouble _tmp36_;
										gdouble _tmp37_;
										gdouble* _tmp38_;
										guint32 _tmp39_;
										gdouble* _tmp40_;
										guint32 _tmp41_;
										gdouble _tmp42_;
										gdouble* _tmp43_;
										gint _tmp44_;
										gdouble _tmp45_;
										gdouble _tmp46_;
										gdouble* _tmp47_;
										guint32 _tmp48_;
										gdouble* _tmp49_;
										guint32 _tmp50_;
										gdouble _tmp51_;
										gdouble* _tmp52_;
										gint _tmp53_;
										gdouble _tmp54_;
										gdouble _tmp55_;
										if (!_tmp11_) {
											gint _tmp12_;
											_tmp12_ = k;
											k = _tmp12_ + 1;
										}
										_tmp11_ = FALSE;
										_tmp13_ = k;
										_tmp14_ = gausswidth;
										if (!(_tmp13_ < _tmp14_)) {
											break;
										}
										_tmp15_ = cur_pixel;
										_tmp16_ = shift;
										_tmp16__length1 = shift_length1;
										_tmp16__length2 = shift_length2;
										_tmp17_ = x;
										_tmp18_ = k;
										_tmp19_ = _tmp16_[(_tmp17_ * _tmp16__length2) + _tmp18_];
										source = _tmp15_ + _tmp19_;
										_tmp20_ = dest;
										_tmp21_ = cur_pixel;
										_tmp22_ = src;
										_tmp23_ = source;
										_tmp24_ = _tmp22_[_tmp23_ + 0];
										_tmp25_ = kernel;
										_tmp26_ = k;
										_tmp27_ = _tmp25_[_tmp26_];
										_tmp20_[_tmp21_ + 0] += _tmp24_ * _tmp27_;
										_tmp28_ = _tmp20_[_tmp21_ + 0];
										_tmp29_ = dest;
										_tmp30_ = cur_pixel;
										_tmp31_ = src;
										_tmp32_ = source;
										_tmp33_ = _tmp31_[_tmp32_ + 1];
										_tmp34_ = kernel;
										_tmp35_ = k;
										_tmp36_ = _tmp34_[_tmp35_];
										_tmp29_[_tmp30_ + 1] += _tmp33_ * _tmp36_;
										_tmp37_ = _tmp29_[_tmp30_ + 1];
										_tmp38_ = dest;
										_tmp39_ = cur_pixel;
										_tmp40_ = src;
										_tmp41_ = source;
										_tmp42_ = _tmp40_[_tmp41_ + 2];
										_tmp43_ = kernel;
										_tmp44_ = k;
										_tmp45_ = _tmp43_[_tmp44_];
										_tmp38_[_tmp39_ + 2] += _tmp42_ * _tmp45_;
										_tmp46_ = _tmp38_[_tmp39_ + 2];
										_tmp47_ = dest;
										_tmp48_ = cur_pixel;
										_tmp49_ = src;
										_tmp50_ = source;
										_tmp51_ = _tmp49_[_tmp50_ + 3];
										_tmp52_ = kernel;
										_tmp53_ = k;
										_tmp54_ = _tmp52_[_tmp53_];
										_tmp47_[_tmp48_ + 3] += _tmp51_ * _tmp54_;
										_tmp55_ = _tmp47_[_tmp48_ + 3];
									}
								}
							}
							_tmp56_ = cur_pixel;
							cur_pixel = _tmp56_ + 4;
						}
					}
				}
			}
		}
	}
}


static void granite_drawing_buffer_surface_gaussian_blur_vertical (GraniteDrawingBufferSurface* self, gdouble* src, gdouble* dest, gdouble* kernel, gint gausswidth, gint width, gint height, gint startCol, gint endCol, gint* shift, int shift_length1, int shift_length2) {
	guint32 cur_pixel = 0U;
	gint _tmp0_;
	g_return_if_fail (self != NULL);
	_tmp0_ = startCol;
	cur_pixel = (guint32) (_tmp0_ * 4);
	{
		gint y = 0;
		y = 0;
		{
			gboolean _tmp1_ = FALSE;
			_tmp1_ = TRUE;
			while (TRUE) {
				gint _tmp3_;
				gint _tmp4_;
				guint32 _tmp56_;
				gint _tmp57_;
				gint _tmp58_;
				gint _tmp59_;
				if (!_tmp1_) {
					gint _tmp2_;
					_tmp2_ = y;
					y = _tmp2_ + 1;
				}
				_tmp1_ = FALSE;
				_tmp3_ = y;
				_tmp4_ = height;
				if (!(_tmp3_ < _tmp4_)) {
					break;
				}
				{
					gint x = 0;
					gint _tmp5_;
					_tmp5_ = startCol;
					x = _tmp5_;
					{
						gboolean _tmp6_ = FALSE;
						_tmp6_ = TRUE;
						while (TRUE) {
							gint _tmp8_;
							gint _tmp9_;
							guint32 _tmp55_;
							if (!_tmp6_) {
								gint _tmp7_;
								_tmp7_ = x;
								x = _tmp7_ + 1;
							}
							_tmp6_ = FALSE;
							_tmp8_ = x;
							_tmp9_ = endCol;
							if (!(_tmp8_ < _tmp9_)) {
								break;
							}
							{
								gint k = 0;
								k = 0;
								{
									gboolean _tmp10_ = FALSE;
									_tmp10_ = TRUE;
									while (TRUE) {
										gint _tmp12_;
										gint _tmp13_;
										guint32 source = 0U;
										guint32 _tmp14_;
										gint* _tmp15_;
										gint _tmp15__length1;
										gint _tmp15__length2;
										gint _tmp16_;
										gint _tmp17_;
										gint _tmp18_;
										gdouble* _tmp19_;
										guint32 _tmp20_;
										gdouble* _tmp21_;
										guint32 _tmp22_;
										gdouble _tmp23_;
										gdouble* _tmp24_;
										gint _tmp25_;
										gdouble _tmp26_;
										gdouble _tmp27_;
										gdouble* _tmp28_;
										guint32 _tmp29_;
										gdouble* _tmp30_;
										guint32 _tmp31_;
										gdouble _tmp32_;
										gdouble* _tmp33_;
										gint _tmp34_;
										gdouble _tmp35_;
										gdouble _tmp36_;
										gdouble* _tmp37_;
										guint32 _tmp38_;
										gdouble* _tmp39_;
										guint32 _tmp40_;
										gdouble _tmp41_;
										gdouble* _tmp42_;
										gint _tmp43_;
										gdouble _tmp44_;
										gdouble _tmp45_;
										gdouble* _tmp46_;
										guint32 _tmp47_;
										gdouble* _tmp48_;
										guint32 _tmp49_;
										gdouble _tmp50_;
										gdouble* _tmp51_;
										gint _tmp52_;
										gdouble _tmp53_;
										gdouble _tmp54_;
										if (!_tmp10_) {
											gint _tmp11_;
											_tmp11_ = k;
											k = _tmp11_ + 1;
										}
										_tmp10_ = FALSE;
										_tmp12_ = k;
										_tmp13_ = gausswidth;
										if (!(_tmp12_ < _tmp13_)) {
											break;
										}
										_tmp14_ = cur_pixel;
										_tmp15_ = shift;
										_tmp15__length1 = shift_length1;
										_tmp15__length2 = shift_length2;
										_tmp16_ = y;
										_tmp17_ = k;
										_tmp18_ = _tmp15_[(_tmp16_ * _tmp15__length2) + _tmp17_];
										source = _tmp14_ + _tmp18_;
										_tmp19_ = dest;
										_tmp20_ = cur_pixel;
										_tmp21_ = src;
										_tmp22_ = source;
										_tmp23_ = _tmp21_[_tmp22_ + 0];
										_tmp24_ = kernel;
										_tmp25_ = k;
										_tmp26_ = _tmp24_[_tmp25_];
										_tmp19_[_tmp20_ + 0] += _tmp23_ * _tmp26_;
										_tmp27_ = _tmp19_[_tmp20_ + 0];
										_tmp28_ = dest;
										_tmp29_ = cur_pixel;
										_tmp30_ = src;
										_tmp31_ = source;
										_tmp32_ = _tmp30_[_tmp31_ + 1];
										_tmp33_ = kernel;
										_tmp34_ = k;
										_tmp35_ = _tmp33_[_tmp34_];
										_tmp28_[_tmp29_ + 1] += _tmp32_ * _tmp35_;
										_tmp36_ = _tmp28_[_tmp29_ + 1];
										_tmp37_ = dest;
										_tmp38_ = cur_pixel;
										_tmp39_ = src;
										_tmp40_ = source;
										_tmp41_ = _tmp39_[_tmp40_ + 2];
										_tmp42_ = kernel;
										_tmp43_ = k;
										_tmp44_ = _tmp42_[_tmp43_];
										_tmp37_[_tmp38_ + 2] += _tmp41_ * _tmp44_;
										_tmp45_ = _tmp37_[_tmp38_ + 2];
										_tmp46_ = dest;
										_tmp47_ = cur_pixel;
										_tmp48_ = src;
										_tmp49_ = source;
										_tmp50_ = _tmp48_[_tmp49_ + 3];
										_tmp51_ = kernel;
										_tmp52_ = k;
										_tmp53_ = _tmp51_[_tmp52_];
										_tmp46_[_tmp47_ + 3] += _tmp50_ * _tmp53_;
										_tmp54_ = _tmp46_[_tmp47_ + 3];
									}
								}
							}
							_tmp55_ = cur_pixel;
							cur_pixel = _tmp55_ + 4;
						}
					}
				}
				_tmp56_ = cur_pixel;
				_tmp57_ = width;
				_tmp58_ = endCol;
				_tmp59_ = startCol;
				cur_pixel = _tmp56_ + (((_tmp57_ - _tmp58_) + _tmp59_) * 4);
			}
		}
	}
}


static gdouble* granite_drawing_buffer_surface_build_gaussian_kernel (gint gausswidth, int* result_length1) {
	gdouble* result = NULL;
	gint _tmp0_;
	gdouble* kernel = NULL;
	gint _tmp1_;
	gdouble* _tmp2_;
	gint kernel_length1;
	gint _kernel_size_;
	gdouble sd = 0.0;
	gint range = 0;
	gint _tmp3_;
	gdouble mean = 0.0;
	gint _tmp4_;
	gdouble _tmp5_;
	gdouble gaussSum = 0.0;
	gdouble* _tmp23_;
	gint _tmp23__length1;
	gdouble* _tmp37_;
	gint _tmp37__length1;
	_tmp0_ = gausswidth;
	_vala_return_val_if_fail ((_tmp0_ % 2) == 1, "gausswidth % 2 == 1", NULL);
	_tmp1_ = gausswidth;
	_tmp2_ = g_new0 (gdouble, _tmp1_);
	kernel = _tmp2_;
	kernel_length1 = _tmp1_;
	_kernel_size_ = kernel_length1;
	sd = 255.0;
	_tmp3_ = gausswidth;
	range = _tmp3_;
	_tmp4_ = range;
	_tmp5_ = sd;
	mean = _tmp4_ / _tmp5_;
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp6_ = FALSE;
			_tmp6_ = TRUE;
			while (TRUE) {
				gint _tmp8_;
				gint _tmp9_;
				gdouble* _tmp10_;
				gint _tmp10__length1;
				gint _tmp11_;
				gint _tmp12_;
				gdouble* _tmp13_;
				gint _tmp13__length1;
				gint _tmp14_;
				gint _tmp15_;
				gdouble _tmp16_;
				gint _tmp17_;
				gdouble _tmp18_;
				gdouble _tmp19_;
				gdouble _tmp20_;
				gdouble _tmp21_;
				gdouble _tmp22_;
				if (!_tmp6_) {
					gint _tmp7_;
					_tmp7_ = i;
					i = _tmp7_ + 1;
				}
				_tmp6_ = FALSE;
				_tmp8_ = i;
				_tmp9_ = gausswidth;
				if (!(_tmp8_ < ((_tmp9_ / 2) + 1))) {
					break;
				}
				_tmp10_ = kernel;
				_tmp10__length1 = kernel_length1;
				_tmp11_ = gausswidth;
				_tmp12_ = i;
				_tmp13_ = kernel;
				_tmp13__length1 = kernel_length1;
				_tmp14_ = i;
				_tmp15_ = i;
				_tmp16_ = mean;
				_tmp17_ = range;
				_tmp18_ = sin ((((_tmp15_ + 1) * (G_PI / 2)) - _tmp16_) / _tmp17_);
				_tmp19_ = pow (_tmp18_, (gdouble) 2);
				_tmp20_ = sd;
				_tmp13_[_tmp14_] = _tmp19_ * _tmp20_;
				_tmp21_ = _tmp13_[_tmp14_];
				_tmp10_[(_tmp11_ - _tmp12_) - 1] = _tmp21_;
				_tmp22_ = _tmp10_[(_tmp11_ - _tmp12_) - 1];
			}
		}
	}
	gaussSum = 0.0;
	_tmp23_ = kernel;
	_tmp23__length1 = kernel_length1;
	{
		gdouble* d_collection = NULL;
		gint d_collection_length1 = 0;
		gint _d_collection_size_ = 0;
		gint d_it = 0;
		d_collection = _tmp23_;
		d_collection_length1 = _tmp23__length1;
		for (d_it = 0; d_it < _tmp23__length1; d_it = d_it + 1) {
			gdouble d = 0.0;
			d = d_collection[d_it];
			{
				gdouble _tmp24_;
				gdouble _tmp25_;
				_tmp24_ = gaussSum;
				_tmp25_ = d;
				gaussSum = _tmp24_ + _tmp25_;
			}
		}
	}
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp26_ = FALSE;
			_tmp26_ = TRUE;
			while (TRUE) {
				gint _tmp28_;
				gdouble* _tmp29_;
				gint _tmp29__length1;
				gdouble* _tmp30_;
				gint _tmp30__length1;
				gint _tmp31_;
				gdouble* _tmp32_;
				gint _tmp32__length1;
				gint _tmp33_;
				gdouble _tmp34_;
				gdouble _tmp35_;
				gdouble _tmp36_;
				if (!_tmp26_) {
					gint _tmp27_;
					_tmp27_ = i;
					i = _tmp27_ + 1;
				}
				_tmp26_ = FALSE;
				_tmp28_ = i;
				_tmp29_ = kernel;
				_tmp29__length1 = kernel_length1;
				if (!(_tmp28_ < _tmp29__length1)) {
					break;
				}
				_tmp30_ = kernel;
				_tmp30__length1 = kernel_length1;
				_tmp31_ = i;
				_tmp32_ = kernel;
				_tmp32__length1 = kernel_length1;
				_tmp33_ = i;
				_tmp34_ = _tmp32_[_tmp33_];
				_tmp35_ = gaussSum;
				_tmp30_[_tmp31_] = _tmp34_ / _tmp35_;
				_tmp36_ = _tmp30_[_tmp31_];
			}
		}
	}
	_tmp37_ = kernel;
	_tmp37__length1 = kernel_length1;
	if (result_length1) {
		*result_length1 = _tmp37__length1;
	}
	result = _tmp37_;
	return result;
}


cairo_surface_t* granite_drawing_buffer_surface_get_surface (GraniteDrawingBufferSurface* self) {
	cairo_surface_t* result;
	cairo_surface_t* _tmp0_;
	cairo_surface_t* _tmp4_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = self->priv->_surface;
	if (_tmp0_ == NULL) {
		gint _tmp1_;
		gint _tmp2_;
		cairo_surface_t* _tmp3_;
		_tmp1_ = self->priv->_width;
		_tmp2_ = self->priv->_height;
		_tmp3_ = cairo_image_surface_create (CAIRO_FORMAT_ARGB32, _tmp1_, _tmp2_);
		_cairo_surface_destroy0 (self->priv->_surface);
		self->priv->_surface = _tmp3_;
	}
	_tmp4_ = self->priv->_surface;
	result = _tmp4_;
	return result;
}


static gpointer _cairo_surface_reference0 (gpointer self) {
	return self ? cairo_surface_reference (self) : NULL;
}


static void granite_drawing_buffer_surface_set_surface (GraniteDrawingBufferSurface* self, cairo_surface_t* value) {
	cairo_surface_t* _tmp0_;
	cairo_surface_t* _tmp1_;
	g_return_if_fail (self != NULL);
	_tmp0_ = value;
	_tmp1_ = _cairo_surface_reference0 (_tmp0_);
	_cairo_surface_destroy0 (self->priv->_surface);
	self->priv->_surface = _tmp1_;
	g_object_notify ((GObject *) self, "surface");
}


gint granite_drawing_buffer_surface_get_width (GraniteDrawingBufferSurface* self) {
	gint result;
	gint _tmp0_;
	g_return_val_if_fail (self != NULL, 0);
	_tmp0_ = self->priv->_width;
	result = _tmp0_;
	return result;
}


static void granite_drawing_buffer_surface_set_width (GraniteDrawingBufferSurface* self, gint value) {
	g_return_if_fail (self != NULL);
	if (granite_drawing_buffer_surface_get_width (self) != value) {
		gint _tmp0_;
		_tmp0_ = value;
		self->priv->_width = _tmp0_;
		g_object_notify ((GObject *) self, "width");
	}
}


gint granite_drawing_buffer_surface_get_height (GraniteDrawingBufferSurface* self) {
	gint result;
	gint _tmp0_;
	g_return_val_if_fail (self != NULL, 0);
	_tmp0_ = self->priv->_height;
	result = _tmp0_;
	return result;
}


static void granite_drawing_buffer_surface_set_height (GraniteDrawingBufferSurface* self, gint value) {
	g_return_if_fail (self != NULL);
	if (granite_drawing_buffer_surface_get_height (self) != value) {
		gint _tmp0_;
		_tmp0_ = value;
		self->priv->_height = _tmp0_;
		g_object_notify ((GObject *) self, "height");
	}
}


cairo_t* granite_drawing_buffer_surface_get_context (GraniteDrawingBufferSurface* self) {
	cairo_t* result;
	cairo_t* _tmp0_;
	cairo_t* _tmp4_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = self->priv->_context;
	if (_tmp0_ == NULL) {
		cairo_surface_t* _tmp1_;
		cairo_surface_t* _tmp2_;
		cairo_t* _tmp3_;
		_tmp1_ = granite_drawing_buffer_surface_get_surface (self);
		_tmp2_ = _tmp1_;
		_tmp3_ = cairo_create (_tmp2_);
		_cairo_destroy0 (self->priv->_context);
		self->priv->_context = _tmp3_;
	}
	_tmp4_ = self->priv->_context;
	result = _tmp4_;
	return result;
}


static void granite_drawing_buffer_surface_class_init (GraniteDrawingBufferSurfaceClass * klass) {
	granite_drawing_buffer_surface_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (GraniteDrawingBufferSurfacePrivate));
	G_OBJECT_CLASS (klass)->get_property = _vala_granite_drawing_buffer_surface_get_property;
	G_OBJECT_CLASS (klass)->set_property = _vala_granite_drawing_buffer_surface_set_property;
	G_OBJECT_CLASS (klass)->finalize = granite_drawing_buffer_surface_finalize;
	/**
	         * The {@link Cairo.Surface} which will store the results of all drawing operations
	         * made with {@link Granite.Drawing.BufferSurface.context}.
	         */
	g_object_class_install_property (G_OBJECT_CLASS (klass), GRANITE_DRAWING_BUFFER_SURFACE_SURFACE_PROPERTY, g_param_spec_pointer ("surface", "surface", "surface", G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
	/**
	         * The width of the {@link Granite.Drawing.BufferSurface}, in pixels.
	         */
	g_object_class_install_property (G_OBJECT_CLASS (klass), GRANITE_DRAWING_BUFFER_SURFACE_WIDTH_PROPERTY, g_param_spec_int ("width", "width", "width", G_MININT, G_MAXINT, 0, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
	/**
	         * The height of the BufferSurface, in pixels.
	         */
	g_object_class_install_property (G_OBJECT_CLASS (klass), GRANITE_DRAWING_BUFFER_SURFACE_HEIGHT_PROPERTY, g_param_spec_int ("height", "height", "height", G_MININT, G_MAXINT, 0, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
	/**
	         * The {@link Cairo.Context} for the internal surface. All drawing operations done on this
	         * {@link Granite.Drawing.BufferSurface} should use this context.
	         */
	g_object_class_install_property (G_OBJECT_CLASS (klass), GRANITE_DRAWING_BUFFER_SURFACE_CONTEXT_PROPERTY, g_param_spec_pointer ("context", "context", "context", G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
}


static void granite_drawing_buffer_surface_instance_init (GraniteDrawingBufferSurface * self) {
	self->priv = GRANITE_DRAWING_BUFFER_SURFACE_GET_PRIVATE (self);
}


static void granite_drawing_buffer_surface_finalize (GObject * obj) {
	GraniteDrawingBufferSurface * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, GRANITE_DRAWING_TYPE_BUFFER_SURFACE, GraniteDrawingBufferSurface);
	_cairo_surface_destroy0 (self->priv->_surface);
	_cairo_destroy0 (self->priv->_context);
	G_OBJECT_CLASS (granite_drawing_buffer_surface_parent_class)->finalize (obj);
}


/**
     * A buffer containing an internal Cairo-usable surface and context, designed
     * for usage with large, rarely updated draw operations.
     */
GType granite_drawing_buffer_surface_get_type (void) {
	static volatile gsize granite_drawing_buffer_surface_type_id__volatile = 0;
	if (g_once_init_enter (&granite_drawing_buffer_surface_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (GraniteDrawingBufferSurfaceClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) granite_drawing_buffer_surface_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (GraniteDrawingBufferSurface), 0, (GInstanceInitFunc) granite_drawing_buffer_surface_instance_init, NULL };
		GType granite_drawing_buffer_surface_type_id;
		granite_drawing_buffer_surface_type_id = g_type_register_static (G_TYPE_OBJECT, "GraniteDrawingBufferSurface", &g_define_type_info, 0);
		g_once_init_leave (&granite_drawing_buffer_surface_type_id__volatile, granite_drawing_buffer_surface_type_id);
	}
	return granite_drawing_buffer_surface_type_id__volatile;
}


static void _vala_granite_drawing_buffer_surface_get_property (GObject * object, guint property_id, GValue * value, GParamSpec * pspec) {
	GraniteDrawingBufferSurface * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (object, GRANITE_DRAWING_TYPE_BUFFER_SURFACE, GraniteDrawingBufferSurface);
	switch (property_id) {
		case GRANITE_DRAWING_BUFFER_SURFACE_SURFACE_PROPERTY:
		g_value_set_pointer (value, granite_drawing_buffer_surface_get_surface (self));
		break;
		case GRANITE_DRAWING_BUFFER_SURFACE_WIDTH_PROPERTY:
		g_value_set_int (value, granite_drawing_buffer_surface_get_width (self));
		break;
		case GRANITE_DRAWING_BUFFER_SURFACE_HEIGHT_PROPERTY:
		g_value_set_int (value, granite_drawing_buffer_surface_get_height (self));
		break;
		case GRANITE_DRAWING_BUFFER_SURFACE_CONTEXT_PROPERTY:
		g_value_set_pointer (value, granite_drawing_buffer_surface_get_context (self));
		break;
		default:
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
		break;
	}
}


static void _vala_granite_drawing_buffer_surface_set_property (GObject * object, guint property_id, const GValue * value, GParamSpec * pspec) {
	GraniteDrawingBufferSurface * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (object, GRANITE_DRAWING_TYPE_BUFFER_SURFACE, GraniteDrawingBufferSurface);
	switch (property_id) {
		case GRANITE_DRAWING_BUFFER_SURFACE_SURFACE_PROPERTY:
		granite_drawing_buffer_surface_set_surface (self, g_value_get_pointer (value));
		break;
		case GRANITE_DRAWING_BUFFER_SURFACE_WIDTH_PROPERTY:
		granite_drawing_buffer_surface_set_width (self, g_value_get_int (value));
		break;
		case GRANITE_DRAWING_BUFFER_SURFACE_HEIGHT_PROPERTY:
		granite_drawing_buffer_surface_set_height (self, g_value_get_int (value));
		break;
		default:
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
		break;
	}
}



